!function(i,t,e,a){"use strict";i("body").hasClass("wp-admin")&&(i("body").hasClass("widgets-php")||i("body").hasClass("wp-customizer"))?i(t).load(function(){i("body").piklistgroups().piklistcolumns().piklistaddmore({sortable:!0}).piklistmediaupload().piklistfields(),piklist.loaded=!0}):i(e).ready(function(){i("body").piklistgroups().piklistcolumns().piklistaddmore({sortable:!0}).piklistmediaupload().piklistfields(),piklist.loaded=!0});var s=function(t,e){this.element=i(t);var a=this.element.find('[name="'+piklist.prefix+'[fields]"]'),s=a.length>0?a:this.element.parents("form:first").find('[name="'+piklist.prefix+'[fields]"]');this.ids=s.map(function(){return i(this).val()}).get(),this._init(),void 0!==piklist.validate&&piklist.validate&&this.validation()};s.prototype={constructor:s,processed_conditions:[],events:[],templates:[],_init:function(){var t;for(var e in this.ids)void 0!==(t=i(':input[name="'+piklist.prefix+'[fields]"][value="'+this.ids[e]+'"]').data("piklist-fields"))&&this.process_fields(this.ids[e],t);this.process_events()},process_fields:function(i,t){for(var e in t)for(var a in t[e])this.process_field(t[e][a],i)},process_events:function(){for(var t in this.processed_conditions)i(t+':not([type="hidden"])',this.element).off("change",this.conditions_handler),i(t+':not([type="hidden"])',this.element).on("change",{piklistfields:this,list:this.processed_conditions[t]},this.conditions_handler),i(t,this.element).trigger("change")},process_field:function(a,s){if(a.id&&a.id.indexOf("__i__")>-1){var l=i('input[value="'+s+'"]:last').parents(".widget").attr("id"),d=l.charAt(l.length-1);if(isNaN(parseFloat(d))||!isFinite(d))return!1;a.id=a.id.toString().replace("__i__",d),a.name=a.name.toString().replace("__i__",d)}if(a.multiple&&a.name)if(a.name.match(/\[[\d]+\]/g)){for(var n="",r=a.name.split(/\[[\d]+\]/),o=0;o<r.length;o++)0===o?n+=':input[name^="'+r[o]+'"]':o==r.length-1?n+='[name$="'+r[o]+'"]':n+='[name*="'+r[o]+'"]';i(n+=':not([type="hidden"])',this.element).on("change",this.multiple_handler).each(this.multiple_handler)}else i(':input[name="'+a.name+'"]:not([type="hidden"])',this.element).on("change",this.multiple_handler).each(this.multiple_handler);if(a.conditions){var p,c;for(var o in a.conditions)if("relation"!=o&&void 0!==a.name){switch(a.conditions[o].type){case"update":p='[name="'+a.conditions[o].name+'"]',c=':input[name="'+a.name+'"]';break;default:p='[name="'+a.name+'"]',c="."+a.conditions[o].id}void 0===this.processed_conditions[c]&&(this.processed_conditions[c]=[]),this.processed_conditions[c].push({selector:p,conditions:a.conditions})}i(".piklist-field-condition-toggle",this.element).each(function(){i(this).parents("table.form-table").length>0&&i(this).parents("tr:eq(0)").css({position:"absolute",left:"-9999999px",visibility:"hidden",opacity:0})})}var h="object"==typeof a.options?a.options:null;switch(a.type){case"editor":void 0===this.templates["piklist-editor-proxy"]&&i("#wp-piklist-editor-proxy-wrap").length>0&&(this.templates["piklist-editor-proxy"]=i("#wp-piklist-editor-proxy-wrap").html().trim(),i("#wp-piklist-editor-proxy-wrap").remove());var f=this,u=i("body").hasClass("widgets-php")||i("body").hasClass("wp-customizer"),m=[];i('textarea[name*="'+a.name.split(/(?!^)\[[\d]+\]/g).join('"][name*="')+'"]',this.element).each(function(){var t,e=i(this),s=e.parents(".wp-editor-wrap:eq(0)"),l=e.attr("id"),d=l.replace(/_\d_/g,"_0_").replace(/\d+$/,0);0==l.match(/\d+$/)[0]&&void 0===f.templates[l]&&(f.templates[l]=s.prop("outerHTML")),void 0===tinyMCEPreInit.qtInit[l]&&a.options.qtInit&&(tinyMCEPreInit.qtInit[l]=JSON.parse(JSON.stringify(a.options.qtInit)),tinyMCEPreInit.qtInit[l].id=l),void 0===tinyMCEPreInit.mceInit[l]&&a.options.mceInit&&(tinyMCEPreInit.mceInit[l]=JSON.parse(JSON.stringify(a.options.mceInit)),tinyMCEPreInit.mceInit[l].elements=l,tinyMCEPreInit.mceInit[l].selector="#"+l,tinyMCEPreInit.mceInit[l].body_class=tinyMCEPreInit.mceInit[l].body_class.replace(d,l)),0==e.parents("#wp-"+l+"-editor-container").length?(void 0===f.templates[d]&&(d=e.attr("name").replace(/\[[\d]+\]/g,"[0]").replace(/\]/g,"").replace(/\[/g,"_"),d+=(-1!==d.indexOf("_",d.length-1)?null:"_")+0),(t=i(f.templates[d].replace(new RegExp(d,"g"),l))).find("textarea").attr("name",e.attr("name")).attr("id",e.attr("id")).val(e.val()),i(t).insertAfter(s),s.remove(),tinyMCE.execCommand(3==tinymce.majorVersion?"mceRemoveControl":"mceRemoveEditor",!0,l),m.push(l)):u&&(tinyMCE.execCommand(3==tinymce.majorVersion?"mceRemoveControl":"mceRemoveEditor",!0,l),m.push(l)),e.hasClass("piklist-error")&&s.addClass("piklist-error")});for(o=0;o<m.length;o++)void 0!==tinyMCEPreInit.qtInit[m[o]]&&(quicktags(tinyMCEPreInit.qtInit[m[o]]),QTags._buttonsInit()),void 0!==tinyMCEPreInit.mceInit[m[o]]&&("undefined"!=typeof switchEditors&&void 0!==tinyMCEPreInit.qtInit[m[o]]?switchEditors.go(m[o],"tmce"):tinyMCE.init(tinyMCEPreInit.mceInit[m[o]]));break;case"datepicker":i(':input[name*="'+a.name.split(/(?!^)\[[\d]+\]/g).join('"][name*="')+'"]:not(.hasDatepicker)',this.element).each(function(){i(this).attr("autocomplete","off").datepicker(h)});break;case"colorpicker":i(':input[name*="'+a.name.split(/(?!^)\[[\d]+\]/g).join('"][name*="')+'"]',this.element).wpColorPicker(h);break;case"file":i(":input."+a.attributes.class,this.element).data("multiple",void 0!==a.options.multiple?a.options.multiple:"true").data("save",void 0!==a.options.save?a.options.save:"id")}a.js_callback&&t[a.js_callback](a),i(e).trigger("piklist:field:render",[a])},multiple_handler:function(t){var e=i(this).parents("div[data-piklist-field-addmore]:eq(0)"),a=e.length>0?e:null,s=i(':input[name="'+i(this).attr("name")+'"]:not([type="hidden"])'+(i(this).is(":checkbox")||i(this).is(":radio")?":checked":""),a).val(),l=i(':input[name="'+i(this).attr("name")+'"][type="hidden"]',a);s?l.attr("disabled","disabled"):l.removeAttr("disabled","disabled")},conditions_handler:function(t){var e=t.data.piklistfields;for(var a in t.data.list)e.conditions(i(this),t.data.list[a].selector,t.data.list[a].conditions)},conditions:function(t,e,a){var s,l,d,n,r,o,p,c,h,f,u,m,k=[],v=t.parents("div[data-piklist-field-addmore]:eq(0)").length>0?t.parents("div[data-piklist-field-addmore]:eq(0)"):null,g="and",b=t.parents("form:first"),y=t.index('*[name="'+t.attr("name")+'"]:not(:input[type="hidden"])'),w=e.replace(/\[[\d]+(?!.*[\d])\]/,"["+y+"]"),_=[],x=!0,C=[],A={position:"relative",left:"auto",visibility:"visible"},q={position:"absolute",left:"-9999999px",visibility:"hidden",opacity:0};s=i('*[name*="'+(e==w?e:w).replace('[name="',"").replace('"]',"").split(/(?!^)\[[\d]+\]/g).join('"][name*="')+'"]',v);for(n in a)"relation"==n?g=a[n]:k.push(a[n]);d=v||b,r=i(':input[type="hidden"][name="widget_number"]',b);for(n in k)if(void 0!==k[n].name){if(u=!1,C=i.isArray(k[n].value)?k[n].value:[k[n].value],"update"==k[n].type?l=t:(r.length>0?(o=(o=i(':input[type="hidden"][name="multi_number"]',b).val())||r.val(),p=i(':input[type="hidden"][name="id_base"]',b).val(),l='[name^="widget-'+p+"["+o+"]["+k[n].field+']"]'):(l="",i(k[n].field.split(":")).each(function(i,t){l+='[name*="['+t+']"]'})),l=i(":input"+l,d)),l.is("select"))m=l.children("option:selected").val();else if(l.is(":radio, :checkbox")){var I=[];l.each(function(){i(this).is(":checked")&&I.push(i(this).val())}),m=I.length>0?I:m}else m=l.val();i.isArray(m)?(m=i.map(m,function(i,t){return isNaN(i)?i:parseFloat(i)}),u=i.intersect(m,C).length>0):u=-1!=i.inArray(m,C),void 0===k[n].compare&&"!="!=k[n].compare||(u=!u),_.push({condition:k[n],result:u})}for(n=0;n<_.length;n++)"update"!=_[n].condition.type&&("and"==g?x=x&&_[n].result:"or"==g&&(x=x||_[n].result?x||_[n].result:_[n].result));if("or"==g&&x&&_.length>0)for(x=!1,n=0;n<_.length;n++)if(_[n].result){x=!0;break}if(d=null,s.parents("table.form-table:eq(0)").length>0){var E=s.parents("tr:eq(0)");E.find(".piklist-field-element").length-E.find(".piklist-field-element-condition").length<1&&(d=E)}d||(s.parents(".piklist-field-condition-toggle").length>0?d=s.parents(".piklist-field-condition-toggle"):s.parents('div[data-piklist-field-group="'+s.data("piklist-field-group")+'"]').length&&(d=s.parents('div[data-piklist-field-group="'+s.data("piklist-field-group")+'"]'))),d&&d.parent(".piklist-field-addmore-wrapper").length>0&&s.parents(".piklist-field-addmore-wrapper").length>t.parents(".piklist-field-addmore-wrapper").length&&(d=d.parent(".piklist-field-addmore-wrapper"));for(n in _){switch(_[n].condition.type){case"update":h='[name="'+_[n].condition.name+'"]';break;default:h='[name="'+s.attr("name")+'"]'}i(h,d).each(function(){switch(s=i(this),_[n].condition.type){case"update":if(!piklist.loaded)break;if(f=!1,c=t.is(":radio")||t.is(":checkbox")?t.is(":checked")?t.val():"":t.val(),i.isArray(_[n].condition.value)&&i.inArray(c,_[n].condition.value)>-1?f=!0:c==_[n].condition.value&&(f=!t.is(":radio")&&!t.is(":checkbox")||t.is(":checked")),f){if(s.is("select")){if(void 0!==_[n].condition.choices){s.empty();for(var a in _[n].condition.choices)s.append(i("<option></option>").attr("value",a).text(_[n].condition.choices[a]))}s.children('option[value="'+_[n].condition.update+'"]').length>0&&(s.children("option").removeAttr("selected"),s.children('option[value="'+_[n].condition.update+'"]').attr("selected","selected"))}else s.val(_[n].condition.update);s.trigger("change")}break;case"readonly":case"disabled":x?s.attr(_[n].condition.type,_[n].condition.type):s.removeAttr(_[n].condition.type),s.trigger("change");break;default:null!=d&&("hidden"==d.css("visibility")&&x?(d.css(A).animate({opacity:1}),d.find(".piklist-field-condition-hidden").removeClass("piklist-field-condition-hidden")):x||(_[n].condition.reset&&(s.is(":radio")||s.is(":checkbox")?(s=i(e==w?e:w)).is(":checked")&&s.attr("checked",!1).trigger("change"):s.is("select")?s.children('option[selected="selected"]').length>0&&(s.children("option").removeAttr("selected"),s.trigger("change")):""!=s.val()&&s.val("").trigger("change")),d.css(q),s.addClass("piklist-field-condition-hidden")))}})}return!1},validation:function(){this.id_forms=this.element.find('[name="'+piklist.prefix+'[fields]"]').map(function(){return i(this).parents("form:first")}).get();for(var t=0;t<this.id_forms.length;t++)this.id_forms[t].off("submit",this,this.validation_handler).on("submit",this,this.validation_handler)},validation_handler:function(t){var e=i('[name="'+piklist.prefix+'[fields]"]',this);t.data;if(0==e.length)return!1;"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave();var a=i(this),s=a.find(":input[type=submit]:focus"),l=i.param(a.serializeArray()),d=t.originalEvent||t.originalTarget;return 0==s.length&&void 0!==d&&(s=i(d.srcElement||d.originalTarget)),s&&i.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{action:"piklist_validate",method:"check",data:l},beforeSend:function(){i(".spinner").length>0&&i(".spinner").hide(),s.attr("disabled","disabled")},complete:function(i){s.removeAttr("disabled").removeClass("disabled")},success:function(t){if(s.removeAttr("disabled").removeClass("disabled"),t.success)a.off("submit"),s.trigger("click");else{i("#piklist_validation_error").remove(),i(".piklist-error").removeClass("piklist-error");for(var e=0;e<t.data.errors.length;e++){var l=t.data.errors[e],d=i(':input[name="'+l+'"]');0==d.length&&"[]"==l.substr(-2)?(l=l.slice(0,-2),i(':input[name^="'+l+'"]').each(function(){var t=i(this);"hidden"==t.attr("type")&&t.parent(".piklist-field-preview").length>0?t.parent(".piklist-field-preview").prev().addClass("piklist-error"):t.hasClass("wp-editor-area")&&t.parents(".wp-editor-wrap:eq(0)").addClass("piklist-error"),t.addClass("piklist-error")})):("hidden"==d.attr("type")&&d.parent(".piklist-field-preview").length>0?d.parent(".piklist-field-preview").prev().addClass("piklist-error"):d.hasClass("wp-editor-area")&&d.parents(".wp-editor-wrap:eq(0)").addClass("piklist-error"),d.addClass("piklist-error"))}i(t.data.notice).insertBefore(a)}}}),!1}},i.fn.piklistfields=function(t){var e=Array.apply(null,arguments);return e.shift(),this.each(function(){var a=i(this),l=a.data("piklistfields"),d="object"==typeof t&&t;l||a.data("piklistfields",l=new s(this,i.extend({},i.fn.piklistfields.defaults,d,i(this).data()))),"string"==typeof t&&l[t].apply(l,e)})},i.fn.piklistfields.defaults={},i.fn.piklistfields.Constructor=s;var l=function(t,e){this.element=i(t),this._init()};l.prototype={constructor:l,_init:function(){this.element.find("[data-piklist-field-group]:not(:radio, :checkbox, :file, div)").each(function(){var t=i(this),e=':input[name="'+t.attr("name")+'"]',a=t.data("piklist-field-group"),s=t.data("piklist-field-sub-group");t.is("textarea")&&t.hasClass("wp-editor-area")&&(t=i(this).parents(".wp-editor-wrap:first")),t.parents(".piklist-field-part").length>0&&(t=t.parents(".piklist-field-part:eq(0)")),t.prev().hasClass("piklist-label-position-before")?t=t.prevUntil(".piklist-label-position-before",".piklist-field-part:not(div)").addBack().next(':input[type="hidden"].piklist-field-part').addBack().prev(".piklist-label-position-before"):t.next().hasClass("piklist-label-position-after")&&(t=t.nextUntil(".piklist-label-position-after",".piklist-field-part:not(div)").addBack().prev(':input[type="hidden"].piklist-field-part').addBack().next(".piklist-label-position-after")),t.hasClass("wp-editor-wrap")||0!=t.find(e).length||(t=t.addBack()),t.wrapAll('<div data-piklist-field-group="'+a+'" '+(s?'data-piklist-field-sub-group="'+s+'"':"")+" />")}),this.element.find("[data-piklist-field-group]").filter(":radio, :checkbox").each(function(){var t=i(this),e=t.data("piklist-field-group"),a=t.data("piklist-field-sub-group"),s=t.parents(".piklist-field-list").length>0,l=s?".piklist-field-list":".piklist-field-list-item",d=t.parents("div[data-piklist-field-group]:eq(0)"),n=i('<div data-piklist-field-group="'+e+'" '+(a?'data-piklist-field-sub-group="'+a+'"':"")+" />");t.parents(".piklist-field-part").length>0&&(l=".piklist-field-part");i(t.parents(l)).index();d.length>0?(d.attr("data-piklist-field-group",e),a&&d.attr("data-piklist-field-sub-group",a)):(t=s?t.parents(l).prev(".piklist-field-part:eq(0):not(.piklist-label-position-before)").addBack().prev(".piklist-field-part:eq(0):not(.piklist-label-position-after)"):(t=t.parents(l)).prev().hasClass("piklist-label-position-before")||0==t.next().length?t.prev(".piklist-label-position-before").addBack().nextUntil(".piklist-field-part",l):t.next().hasClass("piklist-label-position-after")||0==t.prev().length?t.next(".piklist-label-position-after").addBack().prevUntil(".piklist-field-part",l):t.nextUntil(":not(.piklist-field-list-item)",l).addBack()).addBack().wrapAll(n)}),i(".piklist-group-label").each(function(){var t=i(this),e=t.hasClass("piklist-label-position-before")?t.prev("div[data-piklist-field-group]:eq(0)"):t.next("div[data-piklist-field-group]:eq(0)");if(e.length>0){var a=e.data("piklist-field-group"),s=e.data("piklist-field-sub-group"),l=i('<div data-piklist-field-group="'+a+'" '+(s?'data-piklist-field-sub-group="'+s+'"':"")+" />");t.wrapAll(l)}})}},i.fn.piklistgroups=function(t){var e=Array.apply(null,arguments);return e.shift(),this.each(function(){var a=i(this),s=a.data("piklistgroups"),d="object"==typeof t&&t;s||a.data("piklistgroups",s=new l(this,i.extend({},i.fn.piklistgroups.defaults,d,i(this).data()))),"string"==typeof t&&s[t].apply(s,e)})},i.fn.piklistgroups.defaults={},i.fn.piklistgroups.Constructor=l;var d=function(t,e){this.element=i(t),this.add=e.add,this.remove=e.remove,this.move=e.move,this.sortable=e.sortable,this._init()};d.prototype={constructor:d,templates:[],_init:function(){var t=this;i("html, body").css("overflow-x","initial"),i(e).on("click","[data-piklist-field-addmore-action]",{piklistaddmore:t},t.action_handler),this.element.find("*[data-piklist-field-addmore]").each(function(){var e=i(this),a=e.data("piklist-field-group"),s=e.attr("name"),l=(e.data("piklist-field-addmore"),e.data("piklist-field-addmore-single")),d=e.data("piklist-field-addmore-actions"),n=i("<div />").attr("data-piklist-field-addmore",s).addClass("piklist-field-addmore-wrapper"),r=i("<div />").addClass("piklist-field-addmore-wrapper-actions").css("display","inline");if(t.sortable=e.data("piklist-field-sortable"),0==e.parents('div[data-piklist-field-addmore="'+e.attr("name")+'"]').length){if(e.is("[data-piklist-field-columns]")&&n.css({float:"none"}),a&&n.addClass("piklist-field-addmore-wrapper-full"),e.is("textarea")&&e.hasClass("wp-editor-area")&&(e=e.parents(".wp-editor-wrap:first"),l&&e.data("piklist-field-addmore-single",!0)),e.is(':checkbox, :radio, :input[type="hidden"]')&&!e.data("piklist-field-group")){(p=i(':input[name="'+e.attr("name")+'"]').commonAncestor()).parents('div[data-piklist-field-group="'+a+'"], div[data-piklist-field-sub-group="'+a+'"]').length>0&&(p=p.parents('div[data-piklist-field-group="'+a+'"], div[data-piklist-field-sub-group="'+a+'"]')),p.parents(".piklist-field-part").length>0&&(p=p.parents(".piklist-field-part:eq(0)")),e.is(':input[type="hidden"]')&&n.addClass("piklist-field-addmore-wrapper-full"),0==p.parent('div[data-piklist-field-addmore="'+e.attr("name")+'"]').length&&(e=p.siblings('div[data-piklist-field-group="'+a+'"], div[data-piklist-field-sub-group="'+a+'"], .piklist-field-part:first').addBack().wrapAll(n))}else void 0===a?e=e.parent(".piklist-field-column").length>0?e.parent(".piklist-field-column").wrapAll(n):e.siblings(".piklist-field-part").addBack().wrapAll(n):l?e.parents('div[data-piklist-field-group="'+a+'"], div[data-piklist-field-sub-group="'+a+'"]').wrapAll(n):(s=i('div[data-piklist-field-group="'+a+'"]'),(s=t.get_groups(s,a)).wrapAll(n));var o=e.parents("div[data-piklist-field-addmore"+("string"==typeof s?'="'+s+'"':"")+"]:first"),p=o.parent();d?((i("body").hasClass("widgets-php")||i("body").hasClass("wp-customizer")?o.actual("height"):o.height())>=60&&(r.addClass("piklist-field-addmore-wrapper-actions-vertical"),o.addClass("piklist-field-addmore-wrapper-vertical")),r.prepend(i(t.add).attr("data-piklist-field-addmore-action","add")),r.prepend(i(t.remove).attr("data-piklist-field-addmore-action","remove"))):o.addClass("piklist-field-sortable"),t.sortable&&o.addClass("piklist-field-sortable-active"),p.sortable({items:"> div[data-piklist-field-addmore]:not([name])",cursor:"move",placeholder:"piklist-addmore-placeholder",disabled:!t.sortable,cancel:".wp-editor-tabs, .wp-editor-container, :input, a",start:function(i,t){t.placeholder.height(t.item.innerHeight()),t.placeholder.width(t.item.outerWidth())},update:function(e,a){t.re_index(i(this),!0)}}),0==e.siblings(".piklist-field-addmore-wrapper-actions").length&&e.parents("div.piklist-field-addmore-wrapper:eq(0)").append(r)}}),this.element.find("*[data-piklist-field-addmore]").each(function(){var e=i(this).parents("div[data-piklist-field-addmore]:first"),a=e.data("piklist-field-addmore"),s=[],l="[data-piklist-field-addmore], [data-piklist-field-group], .piklist-field-addmore-wrapper-actions, .piklist-field-addmore-wrapper, .piklist-field-column";if(void 0!==a){var d=a.replace(/(?!^)\[[\d]+\]/g,"[0]");void 0===t.templates[d]&&((e=i("<div/>").append(e.parent().html())).find("div[data-piklist-field-addmore]").each(function(){var t=i(this).data("piklist-field-addmore").replace(/(?!^)\[[\d]+\]/g,"[0]");-1==i.inArray(t,s)?(i(this).find(':input:not([data-piklist-field-addmore-clear="0"])').each(function(){i(this).removeClass("piklist-error").attr("data-piklist-original-id",i(this).attr("id")).removeAttr("id").off().find("option").removeAttr("selected"),i(this).is(":checkbox")&&i(this).removeAttr("checked"),i(this).is(":checkbox, :radio")||i(this).removeAttr("value"),i(this).is("textarea")&&i(this).empty()}),i(this).prev().is(l)||i(this).prev().remove(),i(this).next().is(l)||i(this).next().remove(),i(this).find('.piklist-field-preview *:not(ul.attachments, div.piklist-field-addmore-wrapper-actions, div.piklist-field-addmore-wrapper-actions *, :input[type="hidden"])').remove(),s.push(t)):i(this).remove()}),e.children().each(function(){i(this).is('.piklist-field-addmore-wrapper-actions, [data-piklist-field-addmore="'+a+'"]')||i(this).remove()}),t.templates[d]=e.html().trim())}}),i(".wp-editor-area, .wp-editor-area-proxy").parents(".piklist-field-addmore-wrapper").addClass("piklist-field-addmore-wrapper-full")},get_groups:function(t,e){var a=this,s=!1,l=e;do{i('div[data-piklist-field-sub-group="'+l+'"]').each(function(){l=i(this).data("piklist-field-group"),t.push(this),t=a.get_groups(t,l)}),s=0==i('div[data-piklist-field-sub-group="'+l+'"]').length}while(!s);return t},action_handler:function(t){if(t.preventDefault(),!t.isPropagationStopped()){t.stopPropagation();for(var e=i(this),a=e.parents("div.piklist-field-addmore-wrapper:first"),s=a.siblings("div.piklist-field-addmore-wrapper").length,l=a.data("piklist-field-addmore"),d=l?l.replace(/\]/g,"").split("["):[],n=t.data.piklistaddmore,r=d.length-1;r>=0;r--)i.isNumeric(d[r])&&1;switch(a.parent(".ui-sortable").css("height","auto"),e.data("piklist-field-addmore-action")){case"add":var o=a.attr("data-piklist-field-addmore").replace(/(?!^)\[[\d]+\]/g,"[0]"),p=n.templates[o],c=i(p).find('div[data-piklist-field-addmore="'+o+'"]:first');c.length>0&&(p=i(c).clone().wrap("<div>").parent().html()),a.parent().find(":radio").each(function(){i(this).is(":checked")&&i(this).data("piklist-field-checked","true")}),i(p).insertAfter(a),a.parent().children("div.piklist-field-addmore-wrapper").each(function(t){i(this).sortable({items:"> div[data-piklist-field-addmore]:not([name])",cursor:"move",placeholder:"piklist-addmore-placeholder",cancel:".wp-editor-tabs, .wp-editor-container, :input, a",start:function(i,t){t.placeholder.height(t.item.innerHeight()),t.placeholder.width(t.item.outerWidth())},update:function(t,e){n.re_index(i(this),!0)}})}),n.re_index(a.parent(),!1),(a=a.next()).trigger("piklistaddmore",[a,"add"]),a.find(".wp-editor-wrap").length>0&&a.addClass("piklist-field-addmore-wrapper-full");break;case"remove":if(s>0){var h=a.parent();h.children("div.piklist-field-addmore-wrapper");a.trigger("piklistaddmore",[a,"remove"]).remove(),n.re_index(h,!0)}}}},re_index:function(t,e){0!=t.length&&(t.find("> div[data-piklist-field-addmore]").each(function(){var t=i(this);e&&t.find(":radio").each(function(){i(this).is(":checked")&&i(this).data("piklist-field-checked","true")}),t.find(":input").each(function(){var t,e=i(this).attr("name"),a=i("body").hasClass("widgets-php")||i("body").hasClass("wp-customizer");if(e){for(var s,l=0,d=[],n=e.replace(/\]/g,"").split("["),r=i(this).parents("div[data-piklist-field-addmore]").length-1,o=n[0],p=i(this).parents("div[data-piklist-field-addmore]:eq(0)"),c=i(this).val(),h=0;h<=r;h++)d.push(i(p.parents(".ui-sortable:eq("+h+")").children("div[data-piklist-field-addmore]")).index(0==h?p:p.parents(".ui-sortable:eq("+(h-1)+")")));for(var f=0;f<n.length;f++)i.isNumeric(n[f])&&((!a||a&&l>0)&&i.isNumeric(d[d.length-(a?l:l+1)])&&(n[f]=d[d.length-(a?l:l+1)]),l+=1),n[f]=n[f]+(o!==n[f]?"]":"");s=d.slice(-1).pop(),e=n.join("["),t=a?n.splice(0,2).join("-").replace(/]/g,"")+"-"+n.join("_").replace(/]/g,""):n.join("_").replace(/]/g,""),t+=(-1!==t.indexOf("_",t.length-1)?null:"_")+s,i(this).attr("name",e).attr("id",t),i(this).is(":file")||i(this).val(c),p.find('[for="'+e+'"]').attr("for",e)}});var a=[];t.find(":radio").each(function(){i(this).removeAttr("checked"),-1==i.inArray(i(this).attr("name"),a)&&a.push(i(this).attr("name")),void 0!==i(this).data("piklist-field-checked")&&i(this).attr("checked","checked").removeData("piklist-field-checked")});for(var s in a)0==i(':radio[name="'+a[s]+'"]:checked').length&&i(':radio[name="'+a[s]+'"]:eq(0)').attr("checked","checked")}),t.removeData("piklistmediaupload").removeData("piklistfields").piklistmediaupload().piklistfields())}},i.fn.piklistaddmore=function(t){var e=Array.apply(null,arguments);return e.shift(),this.each(function(){var a=i(this),s=a.data("piklistaddmore"),l="object"==typeof t&&t;s||a.data("piklistaddmore",s=new d(this,i.extend({},i.fn.piklistaddmore.defaults,l,i(this).data()))),"string"==typeof t&&s[t].apply(s,e)})},i.fn.piklistaddmore.defaults={add:'<a href="#" class="'+(i("body").hasClass("wp-admin")?"button-secondary":"")+' piklist-addmore-button piklist-addmore-add"><span>&#43;</span></a>',remove:'<a href="#" class="'+(i("body").hasClass("wp-admin")?"button-secondary":"")+' piklist-addmore-button piklist-addmore-remove"><span>&ndash;</span></a>',sortable:!0},i.fn.piklistaddmore.Constructor=d;var n=function(t,e){this.element=i(t),this.total_columns=e.total_columns,this.column_width=e.column_width,this.gutter_width=e.gutter_width,this.gutter_height=e.gutter_height,this.minimum_height=e.minimum_height,this._init()};n.prototype={constructor:n,_init:function(){var t=this.total_columns,e=this.column_width,a=this.gutter_width,s=this.gutter_height,l=(this.minimum_height,{columns:0,gutters:0,group:!1});this.element.find('[data-piklist-field-columns]:not(:radio, :checkbox, :input[type="hidden"])').each(function(){var t=i(this),l=t.data("piklist-field-columns");t.is("textarea")&&t.hasClass("wp-editor-area")&&(t=i(this).parents(".wp-editor-wrap:first"));var d=t.parent("div[data-piklist-field-group]:eq(0)");d.length>0?d.attr("data-piklist-field-columns",l):t.is("div[data-piklist-field-columns]")||t.siblings(".piklist-field-part:eq(0)").addBack().wrapAll('<div data-piklist-field-columns="'+l+'" />');var n=t;t.is("div[data-piklist-field-columns]")||(n=n.css({width:t.attr("size")||t.is(":button, :submit")?"auto":"100%"}).parent("div[data-piklist-field-columns]")),n.css({display:"block",float:"left",width:l*e+(l-1)*a+"%","margin-right":a+(i.isNumeric(a)?"%":null),"margin-bottom":s+(i.isNumeric(s)?"%":null)})}),this.element.find("[data-piklist-field-columns]").filter(':radio, :checkbox, :input[type="hidden"]').each(function(){var t,l=i(this),d=l.data("piklist-field-columns"),n=l.data("piklist-field-group"),r=l.data("piklist-field-sub-group");t=l.is(":radio, :checkbox")?l.parents(".piklist-field-list").length>0?".piklist-field-list":".piklist-field-list-item":".piklist-field-part",l.parents(t).each(function(){if(0==i(this).parent("div[data-piklist-field-columns]").length){var t=i(this).parent("div[data-piklist-field-group]:eq(0)");t.length>0?t.attr("data-piklist-field-columns",d):i(this).siblings(".piklist-field-part").addBack().wrapAll('<div data-piklist-field-columns="'+d+'" data-piklist-field-group="'+n+'" '+(r?'data-piklist-field-sub-group="'+r+'"':"")+" />"),i(this).parent("div[data-piklist-field-columns]").css({display:"block",float:"left",width:d*e+(d-1)*a+"%","margin-right":a+(i.isNumeric(a)?"%":null),"margin-bottom":s+(i.isNumeric(s)?"%":null)})}})}),this.element.find("div[data-piklist-field-columns]").each(function(e){var a=i(this),s=a.data("piklist-field-columns"),d=a.data("piklist-field-group");a.addClass("piklist-field-column"),void 0!==l.group&&l.group==d||(l={columns:0,gutters:0,group:d}),(l={columns:l.columns+s,gutters:l.gutters+1,group:d}).columns>=t&&(a.addClass("piklist-field-column-last").css({"margin-right":"0"}),l={columns:0,gutters:0,group:!1})})}},i.fn.piklistcolumns=function(t){var e=Array.apply(null,arguments);return e.shift(),this.each(function(){var a=i(this),s=a.data("piklistcolumns"),l="object"==typeof t&&t;s||a.data("piklistcolumns",s=new n(this,i.extend({},i.fn.piklistcolumns.defaults,l,i(this).data()))),"string"==typeof t&&s[t].apply(s,e)})},i.fn.piklistcolumns.defaults={total_columns:12,column_width:7,gutter_width:1.45,gutter_height:"7px"},i.fn.piklistcolumns.Constructor=n;var r=function(t,e){this.element=i(t),this.options=e,this._init()};r.prototype={constructor:r,_init:function(){var t=this;i(".piklist-upload-file-preview .attachments").sortable({items:"li.attachment",cursor:"move",placeholder:"piklist-addmore-placeholder attachment",start:function(i,t){t.placeholder.height(t.item.height()-2),t.placeholder.width(t.item.width())},update:function(t,e){var a=i(this).find("[data-attachment-id]"),s=i(a[0]).data("attachments"),l=i(':input[name="'+s+'"][type="hidden"]'),d=[];a.each(function(t){d.push(i(this).data("attachment-id"))}),i(':input[name="'+s+'"][type="hidden"]:not(:first)').remove(),l.val(d.shift());for(var n=0;n<d.length;n++)i(l.first().clone().removeAttr("id").val(d[n])).insertAfter(i(':input[name="'+s+'"][type="hidden"]:last'))}}),i(e).on("click",".piklist-upload-file-preview .attachment",function(t){t.preventDefault();var e=i(this);e.parents(".piklist-upload-file-preview:first").prev(".piklist-upload-file-button").trigger("click",e.find(".button-link").data("attachmentId"))}),i(e).off("click",".piklist-upload-file-preview .attachment .check").on("click",".piklist-upload-file-preview .attachment .check",function(t){t.preventDefault();var e=i(i(this).parents(".attachments:eq(0)").children()).index(i(this).parents(".attachment:eq(0)")),a=i(this).data("attachment-save"),s=i(this).data("attachments");i(this).data("attachment-"+a);i(':input[name="'+s+'"][type="hidden"]').length>1?i(':input[name="'+s+'"][type="hidden"]:eq('+e+")").remove():i(':input[name="'+s+'"][type="hidden"]:eq('+e+")").val(""),i(this).closest(".piklist-upload-file-preview").trigger("piklist:file:remove",id),i(this).parents(".attachment:first").remove()}),i(e).on("click",".piklist-upload-file-button",function(e,a){e.preventDefault();var s=i(this);i('*[id^="__wp-uploader-"]').length>0&&i('*[id^="__wp-uploader-"]').remove();var l=s.next(".piklist-upload-file-preview").children(':input[type="hidden"]:eq(0)'),d=wp.media.frames.file_frame=wp.media({title:s.attr("title"),button:{text:s.text()},multiple:l.data("multiple")}),n=[];l.siblings(".attachments").find(".attachment").each(function(t,e){n.push(i(e).find(".button-link").data("attachmentId"))}),a&&d.on("open",function(){d.state().get("selection").add(wp.media.attachment(a))}),d.on("select",function(){var e,a,r=d.state().get("selection"),o=s.next(".piklist-upload-file-preview"),p=o.children(':input[type="hidden"]'),c=p.attr("name"),h=o.children("ul.attachments"),f=[];r.map(function(s){var d;s=s.toJSON(),a='style="width: 150px;"',-1===n.indexOf(s.id)&&(s.sizes?(d=s.sizes.full,s.sizes.thumbnail?d=s.sizes.thumbnail:s.sizes.medium?d=s.sizes.medium:s.sizes.large&&(d=s.sizes.large),e=i("body").hasClass("branch-4-2")?'<a class="check" href="#" title="Deselect" tabindex="0" data-attachment-id="'+s.id+'" data-attachment-url="'+s.url+'" data-attachments="'+p.attr("name")+'"><div class="media-modal-icon"></div></a>':'<button type="button" class="button-link check" data-attachment-id="'+s.id+'" data-attachment-url="'+s.url+'" data-attachments="'+p.attr("name")+'"><span class="media-modal-icon"></span><span class="screen-reader-text">Deselect</span></button>',void 0!==t.options.preview_size&&(a='style="width: '+d.width+';"'),h.append(i('<li class="attachment selected" '+a+'><div class="attachment-preview '+(d.width>d.height?"landscape":"portrait")+'"><div class="thumbnail"><div class="centered"><a href="#"><img src="'+d.url+'" /></a></div></div>'+e+"</div></li>"))):(d=s,e=i("body").hasClass("branch-4-2")?'<a class="check" href="#" title="Deselect" tabindex="0" data-attachment-id="'+s.id+'" data-attachment-url="'+s.url+'" data-attachments="'+p.attr("name")+'"><div class="media-modal-icon"></div></a>':'<button type="button" class="button-link check" data-attachment-id="'+s.id+'" data-attachments="'+p.attr("name")+'"><span class="media-modal-icon"></span><span class="screen-reader-text">Deselect</span></button>',h.append(i('<li class="attachment selected" '+a+'><div class="attachment-preview attachment-preview-document type-'+d.type+" subtype-"+d.subtype+' landscape"><div class="thumbnail"><div class="centered"><img src="'+d.icon+'" class="icon" /></div><div class="filename"><div>'+d.filename+"</div></div></div>"+e+"</div></li>"))),f.push("url"==l.data("save")?s.url:s.id))});for(var u=0;u<f.length;u++)""==p.first().val()?p.first().val(f[u]):i(p.first().clone().removeAttr("id").val(f[u])).insertAfter(i(':input[name="'+c+'"]:last'));o.trigger("piklist:file:add",[f]),o.find("li.attachment").addClass("selected")}),d.open()})}},i.fn.piklistmediaupload=function(t){var e=Array.apply(null,arguments);return e.shift(),this.each(function(){var a=i(this),s=a.data("piklistmediaupload"),l="object"==typeof t&&t;s||a.data("piklistmediaupload",s=new r(this,i.extend({},i.fn.piklistmediaupload.defaults,l,i(this).data()))),"string"==typeof t&&s[t].apply(s,e)})},i.fn.piklistmediaupload.defaults={multiple:!0,save:"id"},i.fn.piklistmediaupload.Constructor=r,i(e).on("click",".insert-media.add_media",function(t){tinyMCE.get(i(this).data("editor")).focus()}),t.QTags.closeAllTags=function(i){var e=this.getInstance(i);void 0!==e&&t.QTags._close("",e.canvas,e)},i.fn.reverse=function(){return Array.prototype.reverse.call(this)},i.intersect=function(t,e){return i.grep(t,function(t){return i.inArray(t,e)>-1})},i.fn.commonAncestor=function(){for(var i=null,t=this.eq(0).parents().reverse(),e=t.length-1,a=1,s=this.length;a<s&&e>0;a+=1)for(i=this.eq(a).parents().reverse(),e=Math.min(e,i.length-1);t[e]!==i[e];)e-=1;return t.eq(e)},i.fn.actual=function(t){var e,a=i("<div />").appendTo(i("body"));return a.css({position:"absolute",left:"-9999999px",visibility:"hidden",display:"block"}),e=i(this).clone().appendTo(a),t=void 0!==t&&"width"==t?e.width():e.height(),a.remove(),t}}(jQuery,window,document);