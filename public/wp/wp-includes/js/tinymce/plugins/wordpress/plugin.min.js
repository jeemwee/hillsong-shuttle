tinymce.ui.FloatPanel.zIndex=100100,tinymce.PluginManager.add("wordpress",function(e){function t(t){var n,d,a,r=0;d="hide"===t,e.theme.panel&&(a=e.theme.panel.find(".toolbar:not(.menubar)")),!a||a.length<2||"hide"===t&&!a[1].visible()||(!t&&a[1].visible()&&(t="hide"),tinymce.each(a,function(e,n){n>0&&("hide"===t?(e.hide(),r+=30):(e.show(),r-=30))}),r&&!d&&(tinymce.Env.iOS||(n=e.getContentAreaContainer().firstChild,i.setStyle(n,"height",n.clientHeight+r)),"hide"===t?(setUserSetting("hidetb","0"),o&&o.active(!1)):(setUserSetting("hidetb","1"),o&&o.active(!0))),e.fire("wp-toolbar-toggle"))}function n(){i.hide(i.select("#wp_editbtns, #wp_gallerybtns"))}var o,d,a,i=tinymce.DOM,r=0;return e.addButton("wp_adv",{tooltip:"Toolbar Toggle",cmd:"WP_Adv",onPostRender:function(){(o=this).active("1"===getUserSetting("hidetb"))}}),e.on("PostRender",function(){e.getParam("wordpress_adv_hidden",!0)&&"0"===getUserSetting("hidetb","0")&&t("hide")}),e.addCommand("WP_Adv",function(){t()}),e.on("focus",function(){window.wpActiveEditor=e.id}),e.on("BeforeSetContent",function(t){var n;t.content&&(-1!==t.content.indexOf("\x3c!--more")&&(n=e.editorManager.i18n.translate("Read more..."),t.content=t.content.replace(/<!--more(.*?)-->/g,function(e,t){return'<img src="'+tinymce.Env.transparentSrc+'" data-wp-more="more" data-wp-more-text="'+t+'" class="wp-more-tag mce-wp-more" title="'+n+'" data-mce-resize="false" data-mce-placeholder="1" />'})),-1!==t.content.indexOf("\x3c!--nextpage--\x3e")&&(n=e.editorManager.i18n.translate("Page break"),t.content=t.content.replace(/<!--nextpage-->/g,'<img src="'+tinymce.Env.transparentSrc+'" data-wp-more="nextpage" class="wp-more-tag mce-wp-nextpage" title="'+n+'" data-mce-resize="false" data-mce-placeholder="1" />')))}),e.on("PostProcess",function(e){e.get&&(e.content=e.content.replace(/<img[^>]+>/g,function(e){var t,n="";return-1!==e.indexOf('data-wp-more="more"')?((t=e.match(/data-wp-more-text="([^"]+)"/))&&(n=t[1]),e="\x3c!--more"+n+"--\x3e"):-1!==e.indexOf('data-wp-more="nextpage"')&&(e="\x3c!--nextpage--\x3e"),e}))}),e.on("ResolveName",function(t){var n;"IMG"===t.target.nodeName&&(n=e.dom.getAttrib(t.target,"data-wp-more"))&&(t.name=n)}),e.addCommand("WP_More",function(t){var n,o,d,a="wp-more-tag",i=e.dom,r=e.selection.getNode();a+=" mce-wp-"+(t=t||"more"),d="more"===t?"Read more...":"Next page",d=e.editorManager.i18n.translate(d),o='<img src="'+tinymce.Env.transparentSrc+'" title="'+d+'" class="'+a+'" data-wp-more="'+t+'" data-mce-resize="false" data-mce-placeholder="1" />',"BODY"===r.nodeName||"P"===r.nodeName&&"BODY"===r.parentNode.nodeName?e.insertContent(o):(n=i.getParent(r,function(e){return!(!e.parentNode||"BODY"!==e.parentNode.nodeName)},e.getBody()))&&("P"===n.nodeName?n.appendChild(i.create("p",null,o).firstChild):i.insertAfter(i.create("p",null,o),n),e.nodeChanged())}),e.addCommand("WP_Code",function(){e.formatter.toggle("code")}),e.addCommand("WP_Page",function(){e.execCommand("WP_More","nextpage")}),e.addCommand("WP_Help",function(){e.windowManager.open({url:tinymce.baseURL+"/wp-mce-help.php",title:"Keyboard Shortcuts",width:450,height:420,inline:1,classes:"wp-help"})}),e.addCommand("WP_Medialib",function(){"undefined"!=typeof wp&&wp.media&&wp.media.editor&&wp.media.editor.open(e.id)}),e.addButton("wp_more",{tooltip:"Insert Read More tag",onclick:function(){e.execCommand("WP_More","more")}}),e.addButton("wp_page",{tooltip:"Page break",onclick:function(){e.execCommand("WP_More","nextpage")}}),e.addButton("wp_help",{tooltip:"Keyboard Shortcuts",cmd:"WP_Help"}),e.addButton("wp_code",{tooltip:"Code",cmd:"WP_Code",stateSelector:"code"}),"undefined"!=typeof wp&&wp.media&&wp.media.editor&&e.addMenuItem("add_media",{text:"Add Media",icon:"wp-media-library",context:"insert",cmd:"WP_Medialib"}),e.addMenuItem("wp_more",{text:"Insert Read More tag",icon:"wp_more",context:"insert",onclick:function(){e.execCommand("WP_More","more")}}),e.addMenuItem("wp_page",{text:"Page break",icon:"wp_page",context:"insert",onclick:function(){e.execCommand("WP_More","nextpage")}}),e.on("BeforeExecCommand",function(t){!tinymce.Env.webkit||"InsertUnorderedList"!==t.command&&"InsertOrderedList"!==t.command||(a||(a=e.dom.create("style",{type:"text/css"},"#tinymce,#tinymce span,#tinymce li,#tinymce li>span,#tinymce p,#tinymce p>span{font:medium sans-serif;color:#000;line-height:normal;}")),e.getDoc().head.appendChild(a))}),e.on("ExecCommand",function(t){tinymce.Env.webkit&&a&&("InsertUnorderedList"===t.command||"InsertOrderedList"===t.command)&&e.dom.remove(a)}),e.on("init",function(){var t=tinymce.Env,n=["mceContentBody"],o=e.getDoc(),d=e.dom;tinymce.Env.iOS&&d.addClass(o.documentElement,"ios"),"rtl"===e.getParam("directionality")&&(n.push("rtl"),d.setAttrib(o.documentElement,"dir","rtl")),t.ie?9===parseInt(t.ie,10)?n.push("ie9"):8===parseInt(t.ie,10)?n.push("ie8"):t.ie<8&&n.push("ie7"):t.webkit&&n.push("webkit"),n.push("wp-editor"),tinymce.each(n,function(e){e&&d.addClass(o.body,e)}),e.on("BeforeSetContent",function(e){e.content&&(e.content=e.content.replace(/<p>\s*<(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre|address)( [^>]*)?>/gi,"<$1$2>"),e.content=e.content.replace(/<\/(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre|address)>\s*<\/p>/gi,"</$1>"))}),void 0!==window.jQuery&&window.jQuery(document).triggerHandler("tinymce-editor-init",[e]),window.tinyMCEPreInit&&window.tinyMCEPreInit.dragDropUpload&&d.bind(o,"dragstart dragend dragover drop",function(e){void 0!==window.jQuery&&window.jQuery(document).trigger(new window.jQuery.Event(e))}),e.getParam("wp_paste_filters",!0)&&(tinymce.Env.webkit||e.on("PastePreProcess",function(e){e.content=e.content.replace(/(<[^>]+) style="[^"]*"([^>]*>)/gi,"$1$2"),e.content=e.content.replace(/(<[^>]+) data-mce-style=([^>]+>)/gi,"$1 style=$2")}),e.on("PastePostProcess",function(e){tinymce.each(d.select("p",e.node),function(e){d.isEmpty(e)&&d.remove(e)})}))}),void 0!==window.jQuery&&e.on("keyup",function(t){var n=t.keyCode||t.charCode;n!==r&&(13!==n&&8!==r&&46!==r||window.jQuery(document).triggerHandler("wpcountwords",[e.getContent({format:"raw"})]),r=n)}),e.on("SaveContent",function(t){e.inline||!e.isHidden()?(t.content=t.content.replace(/<p>(?:<br ?\/?>|\u00a0|\uFEFF| )*<\/p>/g,"<p>&nbsp;</p>"),e.getParam("wpautop",!0)&&void 0!==window.switchEditors&&(t.content=window.switchEditors.pre_wpautop(t.content))):t.content=t.element.value}),e.on("BeforeSetContent",function(e){e.content&&(e.content=e.content.replace(/<p>(?:&nbsp;|\u00a0|\uFEFF| )+<\/p>/gi,"<p></p>"))}),e.on("preInit",function(){e.schema.addValidElements("@[id|accesskey|class|dir|lang|style|tabindex|title|contenteditable|draggable|dropzone|hidden|spellcheck|translate],i,b"),tinymce.Env.iOS&&(e.settings.height=300)}),d="alt+shift",e.addShortcut(d+"+c","","JustifyCenter"),e.addShortcut(d+"+r","","JustifyRight"),e.addShortcut(d+"+l","","JustifyLeft"),e.addShortcut(d+"+j","","JustifyFull"),e.addShortcut(d+"+q","","mceBlockQuote"),e.addShortcut(d+"+u","","InsertUnorderedList"),e.addShortcut(d+"+o","","InsertOrderedList"),e.addShortcut(d+"+n","","mceSpellCheck"),e.addShortcut(d+"+s","","unlink"),e.addShortcut(d+"+m","","WP_Medialib"),e.addShortcut(d+"+z","","WP_Adv"),e.addShortcut(d+"+t","","WP_More"),e.addShortcut(d+"+d","","Strikethrough"),e.addShortcut(d+"+h","","WP_Help"),e.addShortcut(d+"+p","","WP_Page"),e.addShortcut(d+"+x","","WP_Code"),e.addShortcut("ctrl+s","",function(){"undefined"!=typeof wp&&wp.autosave&&wp.autosave.server.triggerSave()}),e.on("init",function(){e.dom.bind(e.getWin(),"scroll",function(){n()}),e.dom.bind(e.getBody(),"dragstart",function(){n()})}),e.on("BeforeExecCommand",function(){n()}),e.on("SaveContent",function(){n()}),e.on("MouseDown",function(e){"IMG"!==e.target.nodeName&&n()}),e.on("keydown",function(e){e.which!==tinymce.util.VK.DELETE&&e.which!==tinymce.util.VK.BACKSPACE||n()}),{_showButtons:function(t,n){var o,d,a,r,c;a=e.dom.getViewPort(e.getWin()),o=i.getPos(e.getContentAreaContainer()),d=e.dom.getPos(t),r=Math.max(d.x-a.x,0)+o.x,c=Math.max(d.y-a.y,0)+o.y,i.setStyles(n,{top:c+5+"px",left:r+5+"px",display:"block"})},_hideButtons:n,_setEmbed:function(e){return e.replace(/\[embed\]([\s\S]+?)\[\/embed\][\s\u00a0]*/g,function(e,t){return'<img width="300" height="200" src="'+tinymce.Env.transparentSrc+'" class="wp-oembed" alt="'+t+'" title="'+t+'" data-mce-resize="false" data-mce-placeholder="1" />'})},_getEmbed:function(e){return e.replace(/<img[^>]+>/g,function(e){if(-1!==e.indexOf('class="wp-oembed')){var t=e.match(/alt="([^\"]+)"/);t[1]&&(e="[embed]"+t[1]+"[/embed]")}return e})}}});