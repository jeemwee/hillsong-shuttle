!function(e,t,n){t.wp=t.wp||{},t.wp.heartbeat=new function(){function r(){if("string"==typeof t.pagenow&&(b.screenId=t.pagenow),"string"==typeof t.ajaxurl&&(b.url=t.ajaxurl),"object"==typeof t.heartbeatSettings){var n=t.heartbeatSettings;!b.url&&n.ajaxurl&&(b.url=n.ajaxurl),n.interval&&(b.mainInterval=n.interval,b.mainInterval<15?b.mainInterval=15:b.mainInterval>60&&(b.mainInterval=60)),b.screenId||(b.screenId=n.screenId||"front"),"disable"===n.suspension&&(b.suspendEnabled=!1)}b.mainInterval=1e3*b.mainInterval,b.originalInterval=b.mainInterval,e(t).on("blur.wp-heartbeat-focus",function(){f(),b.winBlurTimer=t.setTimeout(function(){s()},500)}).on("focus.wp-heartbeat-focus",function(){e("iframe").each(function(t,n){o(n)&&(e.removeData(n,"wp-heartbeat-focus"),e(n.contentWindow).off(".wp-heartbeat-focus"))}),l()}).on("unload.wp-heartbeat",function(){b.suspend=!0,b.xhr&&4!==b.xhr.readyState&&b.xhr.abort()}),t.setInterval(function(){!function(){var t=b.userActivity?a()-b.userActivity:0;t>3e5&&b.hasFocus&&s(),b.suspendEnabled&&t>12e5&&(b.suspend=!0),b.userActivityEvents||(m.on("mouseover.wp-heartbeat-active keyup.wp-heartbeat-active",function(){d()}),e("iframe").each(function(t,n){o(n)&&e(n.contentWindow).on("mouseover.wp-heartbeat-active keyup.wp-heartbeat-active",function(){d()})}),b.userActivityEvents=!0)}()},3e4),m.ready(function(){b.lastTick=a(),u()})}function a(){return(new Date).getTime()}function o(e){var n,r=e.src;if(r&&/^https?:\/\//.test(r)&&(n=t.location.origin?t.location.origin:t.location.protocol+"//"+t.location.host,0!==r.indexOf(n)))return!1;try{if(e.contentWindow.document)return!0}catch(e){}return!1}function i(e,t){var n;if(e){switch(e){case"abort":break;case"timeout":n=!0;break;case"error":if(503===t&&b.hasConnected){n=!0;break}case"parsererror":case"empty":case"unknown":b.errorcount++,b.errorcount>2&&b.hasConnected&&(n=!0)}n&&!p()&&(b.connectionError=!0,m.trigger("heartbeat-connection-lost",[e,t]))}}function c(){var n,r;b.connecting||b.suspend||(b.lastTick=a(),r=e.extend({},b.queue),b.queue={},m.trigger("heartbeat-send",[r]),n={data:r,interval:b.tempInterval?b.tempInterval/1e3:b.mainInterval/1e3,_nonce:"object"==typeof t.heartbeatSettings?t.heartbeatSettings.nonce:"",action:"heartbeat",screen_id:b.screenId,has_focus:b.hasFocus},b.connecting=!0,b.xhr=e.ajax({url:b.url,type:"post",timeout:3e4,data:n,dataType:"json"}).always(function(){b.connecting=!1,u()}).done(function(e,t,n){var r;e?(b.hasConnected=!0,p()&&(b.errorcount=0,b.connectionError=!1,m.trigger("heartbeat-connection-restored")),e.nonces_expired?m.trigger("heartbeat-nonces-expired"):(e.heartbeat_interval&&(r=e.heartbeat_interval,delete e.heartbeat_interval),m.trigger("heartbeat-tick",[e,t,n]),r&&h(r))):i("empty")}).fail(function(e,t,n){i(t||"unknown",e.status),m.trigger("heartbeat-error",[e,t,n])}))}function u(){var e=a()-b.lastTick,n=b.mainInterval;b.suspend||(b.hasFocus?b.countdown>0&&b.tempInterval&&(n=b.tempInterval,b.countdown--,b.countdown<1&&(b.tempInterval=0)):n=12e4,t.clearTimeout(b.beatTimer),e<n?b.beatTimer=t.setTimeout(function(){c()},n-e):c())}function s(){v(),b.hasFocus=!1}function l(){v(),b.userActivity=a(),b.suspend=!1,b.hasFocus||(b.hasFocus=!0,u())}function f(){e("iframe").each(function(n,r){o(r)&&(e.data(r,"wp-heartbeat-focus")||(e.data(r,"wp-heartbeat-focus",1),e(r.contentWindow).on("focus.wp-heartbeat-focus",function(){l()}).on("blur.wp-heartbeat-focus",function(){f(),b.frameBlurTimer=t.setTimeout(function(){s()},500)})))})}function v(){t.clearTimeout(b.winBlurTimer),t.clearTimeout(b.frameBlurTimer)}function d(){b.userActivityEvents=!1,m.off(".wp-heartbeat-active"),e("iframe").each(function(t,n){o(n)&&e(n.contentWindow).off(".wp-heartbeat-active")}),l()}function p(){return b.connectionError}function h(e,t){var n,r=b.tempInterval?b.tempInterval:b.mainInterval;if(e){switch(e){case"fast":case 5:n=5e3;break;case 15:n=15e3;break;case 30:n=3e4;break;case 60:n=6e4;break;case"long-polling":return b.mainInterval=0,0;default:n=b.originalInterval}5e3===n?(t=(t=parseInt(t,10)||30)<1||t>30?30:t,b.countdown=t,b.tempInterval=n):(b.countdown=0,b.tempInterval=0,b.mainInterval=n),n!==r&&u()}return b.tempInterval?b.tempInterval/1e3:b.mainInterval/1e3}var m=e(document),b={suspend:!1,suspendEnabled:!0,screenId:"",url:"",lastTick:0,queue:{},mainInterval:60,tempInterval:0,originalInterval:0,countdown:0,connecting:!1,connectionError:!1,errorcount:0,hasConnected:!1,hasFocus:!0,userActivity:0,userActivityEvents:!1,beatTimer:0,winBlurTimer:0,frameBlurTimer:0};return r(),{hasFocus:function(){return b.hasFocus},connectNow:function(){b.lastTick=0,u()},disableSuspend:function(){b.suspendEnabled=!1},interval:h,hasConnectionError:p,enqueue:function(e,t,n){return!(!e||n&&this.isQueued(e)||(b.queue[e]=t,0))},dequeue:function(e){e&&delete b.queue[e]},isQueued:function(e){if(e)return b.queue.hasOwnProperty(e)},getQueuedItem:function(e){if(e)return this.isQueued(e)?b.queue[e]:n}}}}(jQuery,window);