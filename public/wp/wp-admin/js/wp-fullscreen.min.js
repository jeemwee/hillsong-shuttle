!function(e,t){function i(){f.removeClass("wp-dfw-show-ui")}function n(t){o.$dfwWrap.parents().each(function(i,n){var s,r=e(n);if(t?(n.style.position&&r.data("wp-dfw-css-position",n.style.position),r.css("position","static")):(s=(s=r.data("wp-dfw-css-position"))||"",r.css("position",s)),"BODY"===n.nodeName)return!1})}var s,r,o,d,a,l=0,f=e(document.body),c=e(document);r=(s={}).pubsub=new function(){this.topics={},this.subscribe=function(e,t){return this.topics[e]||(this.topics[e]=[]),this.topics[e].push(t),t},this.unsubscribe=function(e,t){var i,n,s=this.topics[e];if(!s)return t||[];if(t){for(i=0,n=s.length;i<n;i++)t==s[i]&&s.splice(i,1);return t}return this.topics[e]=[],s},this.publish=function(e,t){var i,n,s,r=this.topics[e];if(r){for(t=t||[],i=0,n=r.length;i<n;i++)s=!1===r[i].apply(null,t)||s;return!s}}},o=s.settings={visible:!1,mode:"tinymce",id:"",title_id:"",timer:0,toolbar_shown:!1},d=s.toggleUI=function(e){clearTimeout(a),f.hasClass("wp-dfw-show-ui")&&"show"!==e?"autohide"!==e&&f.removeClass("wp-dfw-show-ui"):f.addClass("wp-dfw-show-ui"),"autohide"===e&&(a=setTimeout(i,2e3))},s.on=function(){var i,n,r;if(!o.visible){if(o.$fullscreenFader||s.ui.init(),"object"==typeof t.wp_fullscreen_settings&&e.extend(o,t.wp_fullscreen_settings),!(i=o.id||t.wpActiveEditor)){if(!o.hasTinymce)return;i=tinymce.activeEditor.id}o.id=i,(n=o.$dfwWrap=e("#wp-"+i+"-wrap")).length&&(o.$dfwTextarea=e("#"+i),o.$editorContainer=n.find(".wp-editor-container"),l=c.scrollTop(),o.hasTinymce&&(o.editor=tinymce.get(i)),o.editor&&!o.editor.isHidden()?(o.origHeight=e("#"+i+"_ifr").height(),o.mode="tinymce"):(o.origHeight=o.$dfwTextarea.height(),o.mode="html"),r=void 0===t.adminpage||"post-php"!==t.adminpage&&"post-new-php"!==t.adminpage?i+"-title":"title",o.$dfwTitle=e("#"+r),o.$dfwTitle.length||(o.$dfwTitle=null),s.ui.fade("show","showing","shown"))}},s.off=function(){o.visible&&s.ui.fade("hide","hiding","hidden")},s.switchmode=function(e){var t=o.mode;return e&&o.visible&&o.hasTinymce&&"undefined"!=typeof switchEditors?t==e?t:("tinymce"!==e||o.editor||(o.editor=tinymce.get(o.id),!o.editor&&"undefined"!=typeof tinyMCEPreInit&&tinyMCEPreInit.mceInit&&tinyMCEPreInit.mceInit[o.id]&&(tinyMCEPreInit.mceInit[o.id].wp_fullscreen=!0)),o.mode=e,switchEditors.go(o.id,e),s.refreshButtons(!0),"html"===e&&setTimeout(s.resizeTextarea,200),e):t},s.save=function(){var i=e("#hiddenaction"),n=i.val(),s=e("#wp-fullscreen-save .spinner"),r=e("#wp-fullscreen-save .wp-fullscreen-saved-message"),d=e("#wp-fullscreen-save .wp-fullscreen-error-message");s.show(),d.hide(),r.hide(),i.val("wp-fullscreen-save-post"),o.editor&&!o.editor.isHidden()&&o.editor.save(),e.ajax({url:t.ajaxurl,type:"post",data:e("form#post").serialize(),dataType:"json"}).done(function(t){s.hide(),t&&t.success?(r.show(),setTimeout(function(){r.fadeOut(300)},3e3),t.data&&t.data.last_edited&&e("#wp-fullscreen-save input").attr("title",t.data.last_edited)):d.show()}).fail(function(){s.hide(),d.show()}),i.val(n)},s.dfwWidth=function(t,i){var n;return t&&-1!==t.toString().indexOf("%")?(o.$editorContainer.css("width",t),o.$statusbar.css("width",t),void(o.$dfwTitle&&o.$dfwTitle.css("width",t))):t?(i?n=t:(n=o.$editorContainer.width(),n+=t),void(n<200||n>1200||(o.$editorContainer.width(n),o.$statusbar.width(n),o.$dfwTitle&&o.$dfwTitle.width(n-16),setUserSetting("dfw_width",n)))):(n=e("#wp-fullscreen-body").data("theme-width")||800,o.$editorContainer.width(n),o.$statusbar.width(n),o.$dfwTitle&&o.$dfwTitle.width(n-16),void deleteUserSetting("dfw_width"))},r.subscribe("show",function(){var t=e("#last-edit").text();t&&e("#wp-fullscreen-save input").attr("title",t)}),r.subscribe("showing",function(){f.addClass("wp-fullscreen-active"),o.$dfwWrap.addClass("wp-fullscreen-wrap"),o.$dfwTitle&&(o.$dfwTitle.after('<span id="wp-fullscreen-title-placeholder">'),o.$dfwWrap.prepend(o.$dfwTitle.addClass("wp-fullscreen-title"))),s.refreshButtons(),n(!0),e("#wpadminbar").hide(),d("autohide"),s.bind_resize(),o.editor&&o.editor.execCommand("wpFullScreenOn"),"ontouchstart"in t?s.dfwWidth("90%"):s.dfwWidth(e("#wp-fullscreen-body").data("dfw-width")||800,!0),scrollTo(0,0)}),r.subscribe("shown",function(){o.visible=!0,o.editor&&!o.editor.isHidden()?o.editor.execCommand("wpAutoResize"):s.resizeTextarea("force")}),r.subscribe("hide",function(){c.unbind(".fullscreen"),o.$dfwTextarea.unbind(".wp-dfw-resize")}),r.subscribe("hiding",function(){f.removeClass("wp-fullscreen-active"),o.$dfwTitle&&e("#wp-fullscreen-title-placeholder").before(o.$dfwTitle.removeClass("wp-fullscreen-title").css("width","")).remove(),o.$dfwWrap.removeClass("wp-fullscreen-wrap"),o.$editorContainer.css("width",""),o.$dfwTextarea.add("#"+o.id+"_ifr").height(o.origHeight),o.editor&&o.editor.execCommand("wpFullScreenOff"),n(!1),t.scrollTo(0,l),e("#wpadminbar").show()}),r.subscribe("hidden",function(){o.visible=!1}),s.refreshButtons=function(t){"html"===o.mode?(e("#wp-fullscreen-mode-bar").removeClass("wp-tmce-mode").addClass("wp-html-mode").find("a").removeClass("active").filter(".wp-fullscreen-mode-html").addClass("active"),t?e("#wp-fullscreen-button-bar").fadeOut(150,function(){e(this).addClass("wp-html-mode").fadeIn(150)}):e("#wp-fullscreen-button-bar").addClass("wp-html-mode")):"tinymce"===o.mode&&(e("#wp-fullscreen-mode-bar").removeClass("wp-html-mode").addClass("wp-tmce-mode").find("a").removeClass("active").filter(".wp-fullscreen-mode-tinymce").addClass("active"),t?e("#wp-fullscreen-button-bar").fadeOut(150,function(){e(this).removeClass("wp-html-mode").fadeIn(150)}):e("#wp-fullscreen-button-bar").removeClass("wp-html-mode"))},s.ui={init:function(){var i;o.toolbar=i=e("#fullscreen-topbar"),o.$fullscreenFader=e("#fullscreen-fader"),o.$statusbar=e("#wp-fullscreen-status"),o.hasTinymce="undefined"!=typeof tinymce,o.hasTinymce||e("#wp-fullscreen-mode-bar").hide(),c.keyup(function(e){var t,i=e.keyCode||e.charCode;o.visible&&(!(t=navigator.platform&&-1!==navigator.platform.indexOf("Mac")?e.ctrlKey:e.altKey)||61!==i&&107!==i&&187!==i||(s.dfwWidth(25),e.preventDefault()),!t||45!==i&&109!==i&&189!==i||(s.dfwWidth(-25),e.preventDefault()),t&&48===i&&(s.dfwWidth(0),e.preventDefault()))}),e(t).on("keydown.wp-fullscreen",function(e){27===e.keyCode&&o.visible&&(s.off(),e.stopImmediatePropagation())}),"ontouchstart"in t&&f.addClass("wp-dfw-touch"),i.on("mouseenter",function(){d("show")}).on("mouseleave",function(){d("autohide")}),e("#wp-fullscreen-buttons").on("click.wp-fullscreen","button",function(e){var i=e.currentTarget.id?e.currentTarget.id.substr(6):null;if(o.editor&&"tinymce"===o.mode)switch(i){case"bold":o.editor.execCommand("Bold");break;case"italic":o.editor.execCommand("Italic");break;case"bullist":o.editor.execCommand("InsertUnorderedList");break;case"numlist":o.editor.execCommand("InsertOrderedList");break;case"link":o.editor.execCommand("WP_Link");break;case"unlink":o.editor.execCommand("unlink");break;case"help":o.editor.execCommand("WP_Help");break;case"blockquote":o.editor.execCommand("mceBlockQuote")}else"link"===i&&t.wpLink&&t.wpLink.open();"wp-media-library"===i&&"undefined"!=typeof wp&&wp.media&&wp.media.editor&&wp.media.editor.open(o.id)})},fade:function(e,t,i){o.$fullscreenFader||s.ui.init(),e&&!r.publish(e)||s.fade.In(o.$fullscreenFader,200,function(){t&&r.publish(t),s.fade.Out(o.$fullscreenFader,200,function(){i&&r.publish(i)})})}},s.fade={sensitivity:100,In:function(t,i,n,r){if(n=n||e.noop,i=i||400,r=r||!1,s.fade.transitions){if(t.is(":visible"))return t.addClass("fade-trigger"),t;t.show(),t.first().one("transitionend webkitTransitionEnd",function(){n()}),setTimeout(function(){t.addClass("fade-trigger")},this.sensitivity)}else r&&t.stop(),t.css("opacity",1),t.first().fadeIn(i,n),t.length>1&&t.not(":first").fadeIn(i);return t},Out:function(t,i,n,r){return n=n||e.noop,i=i||400,r=r||!1,t.is(":visible")?(s.fade.transitions?(t.first().one("transitionend webkitTransitionEnd",function(){t.hasClass("fade-trigger")||(t.hide(),n())}),setTimeout(function(){t.removeClass("fade-trigger")},this.sensitivity)):(r&&t.stop(),t.first().fadeOut(i,n),t.length>1&&t.not(":first").fadeOut(i)),t):t},transitions:function(){var e=document.documentElement.style;return"string"==typeof e.WebkitTransition||"string"==typeof e.MozTransition||"string"==typeof e.OTransition||"string"==typeof e.transition}()},s.bind_resize=function(){o.$dfwTextarea.on("keydown.wp-dfw-resize click.wp-dfw-resize paste.wp-dfw-resize",function(){s.resizeTextarea()})},s.resizeTextarea=function(){var e=o.$dfwTextarea[0];e.scrollHeight>e.clientHeight&&(e.style.height=e.scrollHeight+50+"px")},t.wp=t.wp||{},t.wp.editor=t.wp.editor||{},t.wp.editor.fullscreen=s}(jQuery,window);