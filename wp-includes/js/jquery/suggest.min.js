!function(e){e.suggest=function(t,l){function s(){var e=u.offset();o.css({top:e.top+t.offsetHeight+"px",left:e.left+"px"})}function a(e){if(/27$|38$|40$/.test(e.keyCode)&&o.is(":visible")||/^13$|^9$/.test(e.keyCode)&&r())switch(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.returnValue=!1,e.keyCode){case 38:!function(){var e=r();e?e.removeClass(l.selectClass).prev().addClass(l.selectClass):o.children("li:last-child").addClass(l.selectClass)}();break;case 40:$currentResult=r(),$currentResult?$currentResult.removeClass(l.selectClass).next().addClass(l.selectClass):o.children("li:first-child").addClass(l.selectClass);break;case 9:case 13:c();break;case 27:o.hide()}else u.val().length!=p&&(h&&clearTimeout(h),h=setTimeout(n,l.delay),p=u.val().length)}function n(){var t,s,a=e.trim(u.val());l.multiple&&-1!=(t=a.lastIndexOf(l.multipleSep))&&(a=e.trim(a.substr(t+l.multipleSep.length))),a.length>=l.minchars?(cached=function(e){var t;for(t=0;t<f.length;t++)if(f[t].q==e)return f.unshift(f.splice(t,1)[0]),f[0];return!1}(a),cached?i(cached.items):e.get(l.source,{q:a},function(t){o.hide(),i(s=function(t,s){var a,n,i=[],r=t.split(l.delimiter);for(a=0;a<r.length;a++)(n=e.trim(r[a]))&&(n=n.replace(new RegExp(s,"ig"),function(e){return'<span class="'+l.matchClass+'">'+e+"</span>"}),i[i.length]=n);return i}(t,a)),function(e,t,s){var a;for(;f.length&&d+s>l.maxCacheSize;)a=f.pop(),d-=a.size;f.push({q:e,size:s,items:t}),d+=s}(a,s,t.length)})):o.hide()}function i(t){var a,n="";if(t)if(t.length){for(s(),a=0;a<t.length;a++)n+="<li>"+t[a]+"</li>";o.html(n).show(),o.children("li").mouseover(function(){o.children("li").removeClass(l.selectClass),e(this).addClass(l.selectClass)}).click(function(e){e.preventDefault(),e.stopPropagation(),c()})}else o.hide()}function r(){var e;return!!o.is(":visible")&&((e=o.children("li."+l.selectClass)).length||(e=!1),e)}function c(){$currentResult=r(),$currentResult&&(l.multiple?(-1!=u.val().indexOf(l.multipleSep)?$currentVal=u.val().substr(0,u.val().lastIndexOf(l.multipleSep)+l.multipleSep.length)+" ":$currentVal="",u.val($currentVal+$currentResult.text()+l.multipleSep+" "),u.focus()):u.val($currentResult.text()),o.hide(),u.trigger("change"),l.onSelect&&l.onSelect.apply(u[0]))}var u,o,h,p,f,d;u=e(t).attr("autocomplete","off"),o=e("<ul/>"),h=!1,p=0,f=[],d=0,o.addClass(l.resultsClass).appendTo("body"),s(),e(window).on("load",s).on("resize",s),u.blur(function(){setTimeout(function(){o.hide()},200)}),u.keydown(a)},e.fn.suggest=function(t,l){if(t)return l=l||{},l.multiple=l.multiple||!1,l.multipleSep=l.multipleSep||",",l.source=t,l.delay=l.delay||100,l.resultsClass=l.resultsClass||"ac_results",l.selectClass=l.selectClass||"ac_over",l.matchClass=l.matchClass||"ac_match",l.minchars=l.minchars||2,l.delimiter=l.delimiter||"\n",l.onSelect=l.onSelect||!1,l.maxCacheSize=l.maxCacheSize||65536,this.each(function(){new e.suggest(this,l)}),this}}(jQuery);