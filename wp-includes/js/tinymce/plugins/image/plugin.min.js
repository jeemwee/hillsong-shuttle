!function(){var e={},t=function(t,i,n){if("string"!=typeof t)throw"module id must be a string";if(void 0===i)throw"no dependencies for "+t;if(void 0===n)throw"no definition function for "+t;e[t]={deps:i,defn:n,instance:void 0}},i=function(t){var n=e[t];if(void 0===n)throw"module ["+t+"] was undefined";return void 0===n.instance&&function(t){for(var n=e[t],a=n.deps,o=n.defn,r=a.length,l=new Array(r),s=0;s<r;++s)l[s]=i(a[s]);var c=o.apply(null,l);if(void 0===c)throw"module ["+t+"] returned undefined";n.instance=c}(t),n.instance},n=function(e,t){for(var n=e.length,a=new Array(n),o=0;o<n;++o)a.push(i(e[o]));t.apply(null,t)};({}).bolt={module:{api:{define:t,require:n,demand:i}}};var a=t,o=function(e,t){a(e,[],function(){return t})};o("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve),a("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.PluginManager")}),a("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.Tools")}),o("global!document",document),o("global!Math",Math),o("global!RegExp",RegExp),a("tinymce.core.Env",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.Env")}),a("tinymce.core.ui.Factory",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.ui.Factory")}),a("tinymce.core.util.JSON",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.JSON")}),a("tinymce.core.util.XHR",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.XHR")}),a("tinymce.core.util.Promise",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.Promise")}),a("tinymce.plugins.image.core.Uploader",["tinymce.core.util.Promise","tinymce.core.util.Tools","global!document"],function(e,t,i){return function(i){function n(e,t,n,a){var o,r;(o=new XMLHttpRequest).open("POST",i.url),o.withCredentials=i.credentials,o.upload.onprogress=function(e){a(e.loaded/e.total*100)},o.onerror=function(){n("Image upload failed due to a XHR Transport error. Code: "+o.status)},o.onload=function(){var e;o.status<200||o.status>=300?n("HTTP Error: "+o.status):(e=JSON.parse(o.responseText))&&"string"==typeof e.location?t(function(e,t){return e?e.replace(/\/$/,"")+"/"+t.replace(/^\//,""):t}(i.basePath,e.location)):n("Invalid JSON: "+o.responseText)},(r=new FormData).append("file",e.blob(),e.filename()),o.send(r)}function a(t){return!i.url&&function(e){return e===n}(i.handler)?e.reject("Upload url missng from the settings."):function(t,i){return new e(function(e,n){try{i(t,e,n,o)}catch(e){n(e.message)}})}(t,i.handler)}var o=function(){};return i=t.extend({credentials:!1,handler:n},i),{upload:a}}}),a("tinymce.plugins.image.core.Utils",["tinymce.core.util.Tools","global!Math","global!document"],function(e,t,i){return{getImageSize:function(e,n){function a(e,t){o.parentNode&&o.parentNode.removeChild(o),n({width:e,height:t})}var o=i.createElement("img");o.onload=function(){a(t.max(o.width,o.clientWidth),t.max(o.height,o.clientHeight))},o.onerror=function(){a()};var r=o.style;r.visibility="hidden",r.position="fixed",r.bottom=r.left=0,r.width=r.height="auto",i.body.appendChild(o),o.src=e},buildListItems:function(t,i,n){function a(t,n){return n=n||[],e.each(t,function(e){var t={text:e.text||e.title};e.menu?t.menu=a(e.menu):(t.value=e.value,i(t)),n.push(t)}),n}return a(t,n||[])},removePixelSuffix:function(e){return e&&(e=e.replace(/px$/,"")),e},addPixelSuffix:function(e){return e.length>0&&/^[0-9]+$/.test(e)&&(e+="px"),e},mergeMargins:function(e){if(e.margin){var t=e.margin.split(" ");switch(t.length){case 1:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[0],e["margin-bottom"]=e["margin-bottom"]||t[0],e["margin-left"]=e["margin-left"]||t[0];break;case 2:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[0],e["margin-left"]=e["margin-left"]||t[1];break;case 3:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[2],e["margin-left"]=e["margin-left"]||t[1];break;case 4:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[2],e["margin-left"]=e["margin-left"]||t[3]}delete e.margin}return e}}}),a("tinymce.plugins.image.ui.Dialog",["global!document","global!Math","global!RegExp","tinymce.core.Env","tinymce.core.ui.Factory","tinymce.core.util.JSON","tinymce.core.util.Tools","tinymce.core.util.XHR","tinymce.plugins.image.core.Uploader","tinymce.plugins.image.core.Utils"],function(e,t,i,n,a,o,r,l,s,c){return function(e){function u(o){function l(){var t=new(a.get("Throbber"))(f.getEl()),i=this.value(),n=new s({url:T.images_upload_url,basePath:T.images_upload_base_path,credentials:T.images_upload_credentials,handler:T.images_upload_handler}),o=e.editorUpload.blobCache.create({blob:i,name:i.name?i.name.replace(/\.[^\.]+$/,""):null,base64:"data:image/fake;base64,="}),r=function(){t.hide(),URL.revokeObjectURL(o.blobUri())};return t.show(),n.upload(o).then(function(e){var t=f.find("#src");return t.value(e),f.find("tabpanel")[0].activateTab(0),t.fire("change"),r(),e},function(t){e.windowManager.alert(t),r()})}function u(t){return e.schema.getTextBlockElements()[t.nodeName]}function g(){var e,i,n,a;e=f.find("#width")[0],i=f.find("#height")[0],e&&i&&(n=e.value(),a=i.value(),f.find("#constrain")[0].checked()&&b&&y&&n&&a&&(b!=n?(a=t.round(n/b*a),isNaN(a)||i.value(a)):(n=t.round(a/y*n),isNaN(n)||e.value(n))),b=n,y=a)}function m(){if(e.settings.image_advtab){var t=f.toJSON(),i=S.parseStyle(t.style);i=c.mergeMargins(i),t.vspace&&(i["margin-top"]=i["margin-bottom"]=c.addPixelSuffix(t.vspace)),t.hspace&&(i["margin-left"]=i["margin-right"]=c.addPixelSuffix(t.hspace)),t.border&&(i["border-width"]=c.addPixelSuffix(t.border)),f.find("#style").value(S.serializeStyle(S.parseStyle(S.serializeStyle(i))))}}function d(){var t,i;m(),g(),(w=r.extend(w,f.toJSON())).alt||(w.alt=""),w.title||(w.title=""),""===w.width&&(w.width=null),""===w.height&&(w.height=null),w.style||(w.style=null),w={src:w.src,alt:w.alt,title:w.title,width:w.width,height:w.height,style:w.style,caption:w.caption,class:w.class},e.undoManager.transact(function(){if(w.src){if(""===w.title&&(w.title=null),p?S.setAttribs(p,w):(w.id="__mcenew",e.focus(),e.selection.setContent(S.createHTML("img",w)),p=S.get("__mcenew"),S.setAttrib(p,"id",null)),e.editorUpload.uploadImagesAuto(),!1===w.caption&&S.is(p.parentNode,"figure.image")&&(t=p.parentNode,S.setAttrib(p,"contenteditable",null),S.insertAfter(p,t),S.remove(t),e.selection.select(p),e.nodeChanged()),!0!==w.caption)!function(t){function i(){t.onload=t.onerror=null,e.selection&&(e.selection.select(t),e.nodeChanged())}t.onload=function(){w.width||w.height||!_||S.setAttribs(t,{width:t.clientWidth,height:t.clientHeight}),i()},t.onerror=i}(p);else if(!S.is(p.parentNode,"figure.image")){i=p,(p=p.cloneNode(!0)).contentEditable=!0,(t=S.create("figure",{class:"image"})).appendChild(p),t.appendChild(S.create("figcaption",{contentEditable:!0},"Caption")),t.contentEditable=!1;var n=S.getParent(i,u);n?S.split(n,i,t):S.replace(t,i),e.selection.select(t)}}else if(p){var a=S.is(p.parentNode,"figure.image")?p.parentNode:p;S.remove(a),e.focus(),e.nodeChanged(),S.isEmpty(e.getBody())&&(e.setContent(""),e.selection.setCursorLocation())}})}var f,p,h,b,y,v,x,w={},S=e.dom,T=e.settings,_=!1!==T.image_dimensions;p=e.selection.getNode(),(h=S.getParent(p,"figure.image"))&&(p=S.select("img",h)[0]),p&&("IMG"!=p.nodeName||p.getAttribute("data-mce-object")||p.getAttribute("data-mce-placeholder"))&&(p=null),p&&(b=S.getAttrib(p,"width"),y=S.getAttrib(p,"height"),w={src:S.getAttrib(p,"src"),alt:S.getAttrib(p,"alt"),title:S.getAttrib(p,"title"),class:S.getAttrib(p,"class"),width:b,height:y,caption:!!h}),o&&(v={type:"listbox",label:"Image list",values:c.buildListItems(o,function(t){t.value=e.convertURL(t.value||t.url,"src")},[{text:"None",value:""}]),value:w.src&&e.convertURL(w.src,"src"),onselect:function(e){var t=f.find("#alt");(!t.value()||e.lastControl&&t.value()==e.lastControl.text())&&t.value(e.control.text()),f.find("#src").value(e.control.value()).fire("change")},onPostRender:function(){v=this}}),e.settings.image_class_list&&(x={name:"class",type:"listbox",label:"Class",values:c.buildListItems(e.settings.image_class_list,function(t){t.value&&(t.textStyle=function(){return e.formatter.getCssText({inline:"img",classes:[t.value]})})})});var N=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:function(t){var n,a,o,l=t.meta||{};v&&v.value(e.convertURL(this.value(),"src")),r.each(l,function(e,t){f.find("#"+t).value(e)}),l.width||l.height||(n=e.convertURL(this.value(),"src"),a=e.settings.image_prepend_url,o=new i("^(?:[a-z]+:)?//","i"),a&&!o.test(n)&&n.substring(0,a.length)!==a&&(n=a+n),this.value(n),c.getImageSize(e.documentBaseURI.toAbsolute(this.value()),function(e){e.width&&e.height&&_&&(b=e.width,y=e.height,f.find("#width").value(b),f.find("#height").value(y))}))},onbeforecall:function(e){e.meta=f.toJSON()}},v];if(!1!==e.settings.image_description&&N.push({name:"alt",type:"textbox",label:"Image description"}),e.settings.image_title&&N.push({name:"title",type:"textbox",label:"Image Title"}),_&&N.push({type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:g,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:g,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}),N.push(x),e.settings.image_caption&&n.ceFalse&&N.push({name:"caption",type:"checkbox",label:"Caption"}),e.settings.image_advtab||e.settings.images_upload_url){var P=[{title:"General",type:"form",items:N}];if(e.settings.image_advtab&&(p&&(p.style.marginLeft&&p.style.marginRight&&p.style.marginLeft===p.style.marginRight&&(w.hspace=c.removePixelSuffix(p.style.marginLeft)),p.style.marginTop&&p.style.marginBottom&&p.style.marginTop===p.style.marginBottom&&(w.vspace=c.removePixelSuffix(p.style.marginTop)),p.style.borderWidth&&(w.border=c.removePixelSuffix(p.style.borderWidth)),w.style=e.dom.serializeStyle(e.dom.parseStyle(e.dom.getAttrib(p,"style")))),P.push({title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox",onchange:function(){if(e.settings.image_advtab){var t=f.toJSON(),i=S.parseStyle(t.style);f.find("#vspace").value(""),f.find("#hspace").value(""),((i=c.mergeMargins(i))["margin-top"]&&i["margin-bottom"]||i["margin-right"]&&i["margin-left"])&&(i["margin-top"]===i["margin-bottom"]?f.find("#vspace").value(c.removePixelSuffix(i["margin-top"])):f.find("#vspace").value(""),i["margin-right"]===i["margin-left"]?f.find("#hspace").value(c.removePixelSuffix(i["margin-right"])):f.find("#hspace").value("")),i["border-width"]&&f.find("#border").value(c.removePixelSuffix(i["border-width"])),f.find("#style").value(S.serializeStyle(S.parseStyle(S.serializeStyle(i))))}}},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:m},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]})),e.settings.images_upload_url){var C={title:"Upload",type:"form",layout:"flex",direction:"column",align:"stretch",padding:"20 20 20 20",items:[{type:"container",layout:"flex",direction:"column",align:"center",spacing:10,items:[{text:"Browse for an image",type:"browsebutton",accept:".jpg,.jpeg,.png,.gif",onchange:l},{text:"OR",type:"label"}]},{text:"Drop an image here",type:"dropzone",accept:".jpg,.jpeg,.png,.gif",height:100,onchange:l}]};P.push(C)}f=e.windowManager.open({title:"Insert/edit image",data:w,bodyType:"tabpanel",body:P,onSubmit:d})}else f=e.windowManager.open({title:"Insert/edit image",data:w,body:N,onSubmit:d})}function g(){!function(t){var i=e.settings.image_list;"string"==typeof i?l.send({url:i,success:function(e){t(o.parse(e))}}):"function"==typeof i?i(t):t(i)}(u)}return{open:g}}}),a("tinymce.plugins.image.Plugin",["tinymce.core.PluginManager","tinymce.core.util.Tools","tinymce.plugins.image.ui.Dialog"],function(e,t,i){return e.add("image",function(e){e.on("preInit",function(){function i(e){var t=e.attr("class");return t&&/\bimage\b/.test(t)}function n(e){return function(n){function a(t){t.attr("contenteditable",e?"true":null)}for(var o,r=n.length;r--;)i(o=n[r])&&(o.attr("contenteditable",e?"false":null),t.each(o.getAll("figcaption"),a),t.each(o.getAll("img"),a))}}e.parser.addNodeFilter("figure",n(!0)),e.serializer.addNodeFilter("figure",n(!1))}),e.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:i(e).open,stateSelector:"img:not([data-mce-object],[data-mce-placeholder]),figure.image"}),e.addMenuItem("image",{icon:"image",text:"Image",onclick:i(e).open,context:"insert",prependToContext:!0}),e.addCommand("mceImage",i(e).open)}),function(){}}),i("tinymce.plugins.image.Plugin")()}();