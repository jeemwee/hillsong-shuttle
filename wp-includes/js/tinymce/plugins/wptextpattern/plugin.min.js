!function(e,t){function n(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}e.Env.ie&&e.Env.ie<9||e.PluginManager.add("wptextpattern",function(a){function r(){var r,i,o,c,l,s=a.selection.getRng(),f=s.startContainer,g=s.startOffset;if(f&&3===f.nodeType&&f.data.length&&g){var m=f.data.slice(0,g),p=f.data.charAt(g-1);e.each(u,function(e){if(p===e.delimiter.slice(-1)){var t=n(e.delimiter),a=e.delimiter.charAt(0),d=new RegExp("(.*)"+t+".+"+t+"$"),c=m.match(d);if(c){r=c[1].length,i=g-e.delimiter.length;var l=m.charAt(r-1),s=m.charAt(r+e.delimiter.length);if(!(r&&/\S/.test(l)&&(/\s/.test(s)||l===a)||new RegExp("^[\\s"+n(a)+"]+$").test(m.slice(r,i))))return o=e,!1}}}),o&&(c=a.formatter.get(o.format))&&c[0].inline&&(a.undoManager.add(),a.undoManager.transact(function(){f.insertData(g,"\ufeff"),f=f.splitText(r),l=f.splitText(g-r),f.deleteData(0,o.delimiter.length),f.deleteData(f.data.length-o.delimiter.length,o.delimiter.length),a.formatter.apply(o.format,{},f),a.selection.setCursorLocation(l,1)}),t(function(){d="space",a.once("selectionchange",function(){var e;l&&-1!==(e=l.data.indexOf("\ufeff"))&&l.deleteData(e,e+1)})}))}}function i(e){var t,n=a.dom.getParent(e,"p");if(n){for(;(t=n.firstChild)&&3!==t.nodeType;)n=t;if(t)return t.data||(t=t.nextSibling&&3===t.nextSibling.nodeType?t.nextSibling:null),t}}function o(){var n,r,o=a.selection.getRng(),c=o.startContainer;c&&i(c)===c&&(n=c.parentNode,r=c.data,e.each(s,function(e){var i=r.match(e.regExp);if(i&&o.startOffset===i[0].length)return a.undoManager.add(),a.undoManager.transact(function(){c.deleteData(0,i[0].length),n.innerHTML||n.appendChild(document.createElement("br")),a.selection.setCursorLocation(n),a.execCommand(e.cmd)}),t(function(){d="space"}),!1}))}var d,c=e.util.VK,l=a.settings.wptextpattern||{},s=l.space||[{regExp:/^[*-]\s/,cmd:"InsertUnorderedList"},{regExp:/^1[.)]\s/,cmd:"InsertOrderedList"}],f=l.enter||[{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:">",format:"blockquote"},{regExp:/^(-){3,}$/,element:"hr"}],u=l.inline||[{delimiter:"`",format:"code"}];a.on("selectionchange",function(){d=null}),a.on("keydown",function(n){(d&&27===n.keyCode||"space"===d&&n.keyCode===c.BACKSPACE)&&(a.undoManager.undo(),n.preventDefault(),n.stopImmediatePropagation()),c.metaKeyPressed(n)||(n.keyCode===c.ENTER?function(){var n,r,o,c=a.selection.getRng().startContainer,l=i(c),s=f.length;if(l){for(n=l.data;s--;)if(f[s].start){if(0===n.indexOf(f[s].start)){r=f[s];break}}else if(f[s].regExp&&f[s].regExp.test(n)){r=f[s];break}r&&(l===c&&e.trim(n)===r.start||a.once("keyup",function(){a.undoManager.add(),a.undoManager.transact(function(){r.format?(a.formatter.apply(r.format,{},l),l.replaceData(0,l.data.length,function(e){return e?e.replace(/^\s+/,""):""}(l.data.slice(r.start.length)))):r.element&&(o=l.parentNode&&l.parentNode.parentNode)&&o.replaceChild(document.createElement(r.element),l.parentNode)}),t(function(){d="enter"})}))}}():n.keyCode===c.SPACEBAR?t(o):n.keyCode>47&&!(n.keyCode>=91&&n.keyCode<=93)&&t(r))},!0)})}(window.tinymce,window.setTimeout);