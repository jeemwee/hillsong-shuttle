!function(e,n,t){n.wp=n.wp||{},n.wp.heartbeat=new function(){function a(){return(new Date).getTime()}function r(e){var t,a=e.src;if(a&&/^https?:\/\//.test(a)&&(t=n.location.origin?n.location.origin:n.location.protocol+"//"+n.location.host,0!==a.indexOf(t)))return!1;try{if(e.contentWindow.document)return!0}catch(e){}return!1}function i(){p.hasFocus&&!document.hasFocus()?s():!p.hasFocus&&document.hasFocus()&&l()}function o(e,n){var t;if(e){switch(e){case"abort":break;case"timeout":t=!0;break;case"error":if(503===n&&p.hasConnected){t=!0;break}case"parsererror":case"empty":case"unknown":p.errorcount++,p.errorcount>2&&p.hasConnected&&(t=!0)}t&&!d()&&(p.connectionError=!0,I.trigger("heartbeat-connection-lost",[e,n]))}}function c(){var t,r;p.connecting||p.suspend||(p.lastTick=a(),r=e.extend({},p.queue),p.queue={},I.trigger("heartbeat-send",[r]),t={data:r,interval:p.tempInterval?p.tempInterval/1e3:p.mainInterval/1e3,_nonce:"object"==typeof n.heartbeatSettings?n.heartbeatSettings.nonce:"",action:"heartbeat",screen_id:p.screenId,has_focus:p.hasFocus},"customize"===p.screenId&&(t.wp_customize="on"),p.connecting=!0,p.xhr=e.ajax({url:p.url,type:"post",timeout:3e4,data:t,dataType:"json"}).always(function(){p.connecting=!1,u()}).done(function(e,n,t){var a;e?(p.hasConnected=!0,d()&&(p.errorcount=0,p.connectionError=!1,I.trigger("heartbeat-connection-restored")),e.nonces_expired&&I.trigger("heartbeat-nonces-expired"),e.heartbeat_interval&&(a=e.heartbeat_interval,delete e.heartbeat_interval),I.trigger("heartbeat-tick",[e,n,t]),a&&h(a)):o("empty")}).fail(function(e,n,t){o(n||"unknown",e.status),I.trigger("heartbeat-error",[e,n,t])}))}function u(){var e=a()-p.lastTick,t=p.mainInterval;p.suspend||(p.hasFocus?p.countdown>0&&p.tempInterval&&(t=p.tempInterval,p.countdown--,p.countdown<1&&(p.tempInterval=0)):t=12e4,p.minimalInterval&&t<p.minimalInterval&&(t=p.minimalInterval),n.clearTimeout(p.beatTimer),e<t?p.beatTimer=n.setTimeout(function(){c()},t-e):c())}function s(){p.hasFocus=!1}function l(){p.userActivity=a(),p.suspend=!1,p.hasFocus||(p.hasFocus=!0,u())}function m(){p.userActivityEvents=!1,I.off(".wp-heartbeat-active"),e("iframe").each(function(n,t){r(t)&&e(t.contentWindow).off(".wp-heartbeat-active")}),l()}function v(){var n=p.userActivity?a()-p.userActivity:0;n>3e5&&p.hasFocus&&s(),(p.suspendEnabled&&n>6e5||n>36e5)&&(p.suspend=!0),p.userActivityEvents||(I.on("mouseover.wp-heartbeat-active keyup.wp-heartbeat-active touchend.wp-heartbeat-active",function(){m()}),e("iframe").each(function(n,t){r(t)&&e(t.contentWindow).on("mouseover.wp-heartbeat-active keyup.wp-heartbeat-active touchend.wp-heartbeat-active",function(){m()})}),p.userActivityEvents=!0)}function d(){return p.connectionError}function h(e,n){var t,a=p.tempInterval?p.tempInterval:p.mainInterval;if(e){switch(e){case"fast":case 5:t=5e3;break;case 15:t=15e3;break;case 30:t=3e4;break;case 60:t=6e4;break;case 120:t=12e4;break;case"long-polling":return p.mainInterval=0,0;default:t=p.originalInterval}p.minimalInterval&&t<p.minimalInterval&&(t=p.minimalInterval),5e3===t?(n=(n=parseInt(n,10)||30)<1||n>30?30:n,p.countdown=n,p.tempInterval=t):(p.countdown=0,p.tempInterval=0,p.mainInterval=t),t!==a&&u()}return p.tempInterval?p.tempInterval/1e3:p.mainInterval/1e3}var I=e(document),p={suspend:!1,suspendEnabled:!0,screenId:"",url:"",lastTick:0,queue:{},mainInterval:60,tempInterval:0,originalInterval:0,minimalInterval:0,countdown:0,connecting:!1,connectionError:!1,errorcount:0,hasConnected:!1,hasFocus:!0,userActivity:0,userActivityEvents:!1,checkFocusTimer:0,beatTimer:0};return function(){var t,r,o,c;"string"==typeof n.pagenow&&(p.screenId=n.pagenow),"string"==typeof n.ajaxurl&&(p.url=n.ajaxurl),"object"==typeof n.heartbeatSettings&&(t=n.heartbeatSettings,!p.url&&t.ajaxurl&&(p.url=t.ajaxurl),t.interval&&(p.mainInterval=t.interval,p.mainInterval<15?p.mainInterval=15:p.mainInterval>120&&(p.mainInterval=120)),t.minimalInterval&&(t.minimalInterval=parseInt(t.minimalInterval,10),p.minimalInterval=t.minimalInterval>0&&t.minimalInterval<=600?1e3*t.minimalInterval:0),p.minimalInterval&&p.mainInterval<p.minimalInterval&&(p.mainInterval=p.minimalInterval),p.screenId||(p.screenId=t.screenId||"front"),"disable"===t.suspension&&(p.suspendEnabled=!1)),p.mainInterval=1e3*p.mainInterval,p.originalInterval=p.mainInterval,void 0!==document.hidden?(r="hidden",c="visibilitychange",o="visibilityState"):void 0!==document.msHidden?(r="msHidden",c="msvisibilitychange",o="msVisibilityState"):void 0!==document.webkitHidden&&(r="webkitHidden",c="webkitvisibilitychange",o="webkitVisibilityState"),r&&(document[r]&&(p.hasFocus=!1),I.on(c+".wp-heartbeat",function(){"hidden"===document[o]?(s(),n.clearInterval(p.checkFocusTimer)):(l(),document.hasFocus&&(p.checkFocusTimer=n.setInterval(i,1e4)))})),document.hasFocus&&(p.checkFocusTimer=n.setInterval(i,1e4)),e(n).on("unload.wp-heartbeat",function(){p.suspend=!0,p.xhr&&4!==p.xhr.readyState&&p.xhr.abort()}),n.setInterval(v,3e4),I.ready(function(){p.lastTick=a(),u()})}(),{hasFocus:function(){return p.hasFocus},connectNow:function(){p.lastTick=0,u()},disableSuspend:function(){p.suspendEnabled=!1},interval:h,hasConnectionError:d,enqueue:function(e,n,t){return!(!e||t&&this.isQueued(e)||(p.queue[e]=n,0))},dequeue:function(e){e&&delete p.queue[e]},isQueued:function(e){if(e)return p.queue.hasOwnProperty(e)},getQueuedItem:function(e){if(e)return this.isQueued(e)?p.queue[e]:t}}}}(jQuery,window);