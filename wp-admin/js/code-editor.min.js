void 0===window.wp&&(window.wp={}),void 0===window.wp.codeEditor&&(window.wp.codeEditor={}),function(t,n){"use strict";n.codeEditor.defaultSettings={codemirror:{},csslint:{},htmlhint:{},jshint:{},onTabNext:function(){},onTabPrevious:function(){},onChangeLintingErrors:function(){},onUpdateErrorNotice:function(){}},n.codeEditor.initialize=function(e,o){var i,r,s,a;return i=t("string"==typeof e?"#"+e:e),s=t.extend({},n.codeEditor.defaultSettings,o),s.codemirror=t.extend({},s.codemirror),r=n.CodeMirror.fromTextArea(i[0],s.codemirror),function(n,e){function o(){e.onUpdateErrorNotice&&!_.isEqual(r,s)&&(e.onUpdateErrorNotice(r,n),s=r)}function i(){var i=n.getOption("lint");return!!i&&(!0===i?i={}:_.isObject(i)&&(i=t.extend({},i)),i.options||(i.options={}),"javascript"===e.codemirror.mode&&e.jshint&&t.extend(i.options,e.jshint),"css"===e.codemirror.mode&&e.csslint&&t.extend(i.options,e.csslint),"htmlmixed"===e.codemirror.mode&&e.htmlhint&&(i.options.rules=t.extend({},e.htmlhint),e.jshint&&(i.options.rules.jshint=e.jshint),e.csslint&&(i.options.rules.csslint=e.csslint)),i.onUpdateLinting=function(t){return function(i,a,d){var c=_.filter(i,function(t){return"error"===t.severity});t&&t.apply(i,a,d),_.isEqual(c,r)||(r=c,e.onChangeLintingErrors&&e.onChangeLintingErrors(c,i,a,d),(!n.state.focused||0===r.length||s.length>0)&&o())}}(i.onUpdateLinting),i)}var r=[],s=[];n.setOption("lint",i()),n.on("optionChange",function(t,e){var s,a,d="CodeMirror-lint-markers";"lint"===e&&(a=n.getOption("gutters")||[],!0===(s=n.getOption("lint"))?(_.contains(a,d)||n.setOption("gutters",[d].concat(a)),n.setOption("lint",i())):s||n.setOption("gutters",_.without(a,d)),n.getOption("lint")?n.performLint():(r=[],o()))}),n.on("blur",o),n.on("startCompletion",function(){n.off("blur",o)}),n.on("endCompletion",function(){n.on("blur",o),_.delay(function(){n.state.focused||o()},500)}),t(document.body).on("mousedown",function(e){!n.state.focused||t.contains(n.display.wrapper,e.target)||t(e.target).hasClass("CodeMirror-hint")||o()})}(r,s),a={settings:s,codemirror:r},r.showHint&&r.on("keyup",function(t,e){var o,i,s,a,d=/^[a-zA-Z]$/.test(e.key);r.state.completionActive&&d||"string"!==(a=r.getTokenAt(r.getCursor())).type&&"comment"!==a.type&&(s=n.CodeMirror.innerMode(r.getMode(),a.state).mode.name,i=r.doc.getLine(r.doc.getCursor().line).substr(0,r.doc.getCursor().ch),"html"===s||"xml"===s?o="<"===e.key||"/"===e.key&&"tag"===a.type||d&&"tag"===a.type||d&&"attribute"===a.type||"="===a.string&&a.state.htmlState&&a.state.htmlState.tagName:"css"===s?o=d||":"===e.key||" "===e.key&&/:\s+$/.test(i):"javascript"===s?o=d||"."===e.key:"clike"===s&&"application/x-httpd-php"===r.options.mode&&(o="keyword"===a.type||"variable"===a.type),o&&r.showHint({completeSingle:!1}))}),function(n,e){var o=t(n.getTextArea());n.on("blur",function(){o.data("next-tab-blurs",!1)}),n.on("keydown",function(t,i){27!==i.keyCode?9===i.keyCode&&o.data("next-tab-blurs")&&(i.shiftKey?e.onTabPrevious(n,i):e.onTabNext(n,i),o.data("next-tab-blurs",!1),i.preventDefault()):o.data("next-tab-blurs",!0)})}(r,o),a}}(window.jQuery,window.wp);